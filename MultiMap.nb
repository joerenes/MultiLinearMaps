(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    254218,       7356]
NotebookOptionsPosition[    238465,       6839]
NotebookOutlinePosition[    239132,       6863]
CellTagsIndexPosition[    239026,       6858]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["\<\
we have a pile of different associations / dictionaries. 
System is a pair (name,dimension). 
A (vector) space dictionary for a given single system records the system and \
its type (ket or bra). Call it AtomicSpace. 
General spaces associated with several systems are lists of AtomicSpaces. \
Call them Space.
Index dictionaries are lists of spaces, call them IndexDict.
Multilinear maps are given by a pair, an IndexDict and an Array, having the \
same dimensions. Call them MultiMap. (I.e. the IndexDict records which \
systems correspond to which indices in the Array.)
\
\>", "Text",
 CellChangeTimes->{{3.662109685484845*^9, 3.662109826955888*^9}, {
  3.662273261477108*^9, 3.662273462355505*^9}, {3.662274299737558*^9, 
  3.662274326582492*^9}, {3.662274673076333*^9, 3.6622747047240267`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Unprotect", "[", 
  RowBox[{
  "AtomicSpace", ",", "VecSpace", ",", "System", ",", "MapDict", ",", 
   "IndexDict", ",", "MultiMap", ",", "Name", ",", "Dimension"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.662291929221422*^9, 3.662291938837514*^9}, {
  3.662293836512594*^9, 3.662293858663412*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"AtomicSpace\"\>", ",", "\<\"VecSpace\"\>", 
   ",", "\<\"System\"\>", ",", "\<\"MapDict\"\>", ",", "\<\"IndexDict\"\>", 
   ",", "\<\"MultiMap\"\>", ",", "\<\"Name\"\>", ",", "\<\"Dimension\"\>"}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.662291927053184*^9, 3.6622919392657623`*^9}, {
  3.66229381923702*^9, 3.6622938591910133`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["MapDict", "Subsubsection",
 CellChangeTimes->{{3.662283411326865*^9, 3.662283415306919*^9}}],

Cell["\<\
somewhat separately from this, we need to manipulate the mapping dictionary \
for multilinear maps: what are its inputs and what are its outputs. Can we \
compose two given maps in a given order? What systems will be contracted out \
when doing so? Etc. Call such a dictionary MapDict. It is two lists: a list \
of output system names and a list of input system names. \
\>", "Text",
 CellChangeTimes->{{3.662283081954138*^9, 3.6622831925089397`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ContractableSystems", "[", 
     RowBox[{"L_MapDict", ",", "R_MapDict"}], "]"}], ":=", 
    RowBox[{"Intersection", "[", 
     RowBox[{
      RowBox[{"L", "[", 
       RowBox[{"[", "2", "]"}], "]"}], ",", 
      RowBox[{"R", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.66211105437976*^9, 3.662111096031035*^9}, {
   3.662111543944193*^9, 3.662111577017915*^9}, {3.662112373220849*^9, 
   3.662112416396427*^9}, {3.662112481392501*^9, 3.662112486558167*^9}, {
   3.662112653444107*^9, 3.6621126700148287`*^9}, {3.6621127229232597`*^9, 
   3.662112774112805*^9}, {3.662221502598542*^9, 3.662221516579818*^9}, {
   3.6622832694725027`*^9, 3.662283316336261*^9}, 3.6622836919644938`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ComposeMaps", "[", 
    RowBox[{"L_MapDict", ",", "R_MapDict"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"MapDict", "@@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"L", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"Complement", "[", 
            RowBox[{
             RowBox[{"R", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "#"}], "]"}]}], "]"}], ",", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"R", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"Complement", "[", 
            RowBox[{
             RowBox[{"L", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "#"}], "]"}]}], "]"}]}], 
        "}"}], "&"}], "[", 
      RowBox[{"ContractableSystems", "[", 
       RowBox[{"L", ",", "R"}], "]"}], "]"}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"MapDict", "[", 
     RowBox[{"oL_", ",", "iL_"}], "]"}], ",", 
    RowBox[{"MapDict", "[", 
     RowBox[{"oR_", ",", "iR_"}], "]"}]}], "]"}], "^:=", 
  RowBox[{"ComposeMaps", "[", 
   RowBox[{
    RowBox[{"MapDict", "[", 
     RowBox[{"oL", ",", "iL"}], "]"}], ",", 
    RowBox[{"MapDict", "[", 
     RowBox[{"oR", ",", "iR"}], "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.662112778781818*^9, 3.6621127853454742`*^9}, {
   3.66222220550554*^9, 3.66222224433633*^9}, {3.662225610196677*^9, 
   3.662225625889799*^9}, {3.662283226744028*^9, 3.662283245610001*^9}, {
   3.662283323127592*^9, 3.6622833265606203`*^9}, 3.662283584321101*^9, {
   3.662285838418852*^9, 3.6622858438793364`*^9}, {3.66235395226861*^9, 
   3.6623540154804296`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ValidMappingQ", "[", "x_MapDict", "]"}], ":=", 
   RowBox[{"And", "@@", 
    RowBox[{"(", 
     RowBox[{"DuplicateFreeQ", "/@", "x"}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ComposableQ", "[", 
    RowBox[{"L_MapDict", ",", "R_MapDict"}], "]"}], ":=", 
   RowBox[{"ValidMappingQ", "[", 
    RowBox[{"ComposeMaps", "[", 
     RowBox[{"L", ",", "R"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MappingEqualQ", "[", 
    RowBox[{"x_MapDict", ",", "y_MapDict"}], "]"}], ":=", 
   RowBox[{"Equal", "@@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Sort", "/@", "#"}], "&"}], "/@", 
      RowBox[{"{", 
       RowBox[{"x", ",", "y"}], "}"}]}], ")"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.662112488255588*^9, 3.66211248868856*^9}, {
  3.6621127414910717`*^9, 3.662112790396048*^9}, {3.662113490643487*^9, 
  3.6621135831133747`*^9}, {3.662222253457362*^9, 3.662222299179803*^9}, {
  3.662223569444311*^9, 3.662223573763803*^9}, {3.662227133292222*^9, 
  3.66222715884816*^9}, {3.662283330018176*^9, 3.662283393272646*^9}, {
  3.662283586767538*^9, 3.662283624881011*^9}, {3.6622836580806303`*^9, 
  3.662283662495296*^9}, {3.662283696980051*^9, 3.662283698051847*^9}}],

Cell["\<\
strictly speaking, partial traces are outside the scope of composition of \
multilinear maps. (one can do it by composing entangled states at input and \
output, but the point is it is not a composition itself)\
\>", "Text",
 CellChangeTimes->{{3.662283702390099*^9, 3.66228372484581*^9}, {
  3.662283777885207*^9, 3.6622838250450974`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ContractableSystems", "[", "x_MapDict", "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"ContractableSystems", "[", 
    RowBox[{"x", ",", "x"}], "]"}]}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"we", " ", 
     RowBox[{"don", "'"}], "t", " ", "seem", " ", "to", " ", "be", " ", 
     "using", " ", "this", " ", "yet"}], ";", " ", 
    RowBox[{
    "maybe", " ", "for", " ", "something", " ", "like", " ", 
     "ContractAll"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ContractableSystemQ", "[", 
    RowBox[{"x_MapDict", ",", "sysname_"}], "]"}], ":=", 
   RowBox[{"And", "@@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{"#", ",", "sysname"}], "]"}], "&"}], "/@", "x"}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContractableSystemsQ", "[", 
    RowBox[{"x_MapDict", ",", "sysnames_List"}], "]"}], ":=", 
   RowBox[{"And", "@@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"SubsetQ", "[", 
        RowBox[{"#", ",", "sysnames"}], "]"}], "&"}], "/@", "x"}], ")"}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.662283699718206*^9, 3.6622836998993673`*^9}, {
  3.662356436766219*^9, 3.662356526466485*^9}, {3.662357038545026*^9, 
  3.662357069749876*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ContractableSystems", "[", 
  RowBox[{"MapDict", "[", 
   RowBox[{
    RowBox[{"{", "\"\<a\>\"", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\"\<b\>\"", ",", "\"\<a\>\""}], "}"}]}], "]"}], "]"}]], "Input",\

 CellChangeTimes->{{3.662315067868608*^9, 3.6623151216579514`*^9}}],

Cell[BoxData[
 RowBox[{"{", "\<\"a\"\>", "}"}]], "Output",
 CellChangeTimes->{{3.662315091390402*^9, 3.662315122216498*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ValidMappingQ", "[", 
  RowBox[{"MapDict", "[", 
   RowBox[{
    RowBox[{"{", "\"\<a\>\"", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\"\<b\>\"", ",", "\"\<a\>\""}], "}"}]}], "]"}], "]"}]], "Input",\

 CellChangeTimes->{{3.662283626259259*^9, 3.6622836404163647`*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.66228364097106*^9, 3.662291957554069*^9, 
  3.6622938285696363`*^9, 3.662295658206293*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ContractableSystemsQ", "[", 
  RowBox[{
   RowBox[{"MapDict", "[", 
    RowBox[{
     RowBox[{"{", "\"\<a\>\"", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<b\>\"", ",", "\"\<a\>\""}], "}"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"\"\<a\>\"", ",", "\"\<b\>\""}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6623565340432367`*^9, 3.6623565485596437`*^9}}],

Cell[BoxData["False"], "Output",
 CellChangeTimes->{{3.662356545416499*^9, 3.662356549312112*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["System", "Subsubsection",
 CellChangeTimes->{{3.662283418928402*^9, 3.662283422464493*^9}}],

Cell["\<\
System is the ordered pair of the system name and its dimension. There\
\[CloseCurlyQuote]s no reason to have a constructor, just type \
\[OpenCurlyDoubleQuote]System\[CloseCurlyDoubleQuote] and give it these two \
things as arguments. \
\>", "Text",
 CellChangeTimes->{{3.6622734846710176`*^9, 3.662273540990765*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"a", "=", 
   RowBox[{"System", "[", 
    RowBox[{"\"\<a\>\"", ",", "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b", "=", 
   RowBox[{"System", "[", 
    RowBox[{"\"\<b\>\"", ",", "4"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"c", "=", 
   RowBox[{"System", "[", 
    RowBox[{"\"\<c\>\"", ",", "3"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"d", "=", 
   RowBox[{"System", "[", 
    RowBox[{"\"\<d\>\"", ",", "7"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.66227347710021*^9, 3.662273503171404*^9}, {
  3.662273585381023*^9, 3.662273586900214*^9}, {3.662273686253149*^9, 
  3.6622736909546537`*^9}, {3.662274855412529*^9, 3.66227486189627*^9}, {
  3.662285558026546*^9, 3.662285564309938*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Name", "[", "x_System", "]"}], ":=", 
   RowBox[{"x", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Dimension", "[", "x_System", "]"}], ":=", 
   RowBox[{"x", "[", 
    RowBox[{"[", "2", "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.662275700336529*^9, 3.662275729057496*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["AtomicSpace", "Subsubsection",
 CellChangeTimes->{{3.6622834272148533`*^9, 3.662283430061561*^9}}],

Cell["\<\
Atomic spaces are ordered triples of a system name, dimension, and one of the \
two strings \[OpenCurlyDoubleQuote]ket\[CloseCurlyDoubleQuote] or \
\[OpenCurlyDoubleQuote]bra\[CloseCurlyDoubleQuote]. The dimension information \
is present in \
\>", "Text",
 CellChangeTimes->{{3.6622736274062757`*^9, 3.662273671183414*^9}, {
   3.662274345450026*^9, 3.662274356796391*^9}, {3.6622743883435507`*^9, 
   3.662274402525012*^9}, 3.662274465746611*^9, 3.662274713709137*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"asp1", "=", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{"a", ",", "\"\<ket\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"asp2", "=", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{"b", ",", "\"\<bra\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"asp3", "=", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{"a", ",", "\"\<bra\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"asp4", "=", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{"c", ",", "\"\<ket\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"asp6", "=", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{"c", ",", "\"\<bra\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"asp5", "=", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{"d", ",", "\"\<ket\>\""}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6622735779167337`*^9, 3.6622736240913477`*^9}, {
  3.662273697277484*^9, 3.6622737078734493`*^9}, {3.6622737939325027`*^9, 
  3.66227379464914*^9}, {3.662274017787868*^9, 3.662274029715137*^9}, {
  3.6622745256860027`*^9, 3.662274531386921*^9}, {3.66227486407924*^9, 
  3.66227488055497*^9}, {3.662285573008834*^9, 3.662285586378227*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Name", "[", "x_AtomicSpace", "]"}], ":=", 
  RowBox[{"Name", "[", 
   RowBox[{"x", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Dimension", "[", "x_AtomicSpace", "]"}], ":=", 
   RowBox[{"Dimension", "[", 
    RowBox[{"x", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Type", "[", "x_AtomicSpace", "]"}], ":=", 
   RowBox[{"x", "[", 
    RowBox[{"[", "2", "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.662275753411787*^9, 3.66227579702544*^9}, {
  3.662288496675582*^9, 3.662288496719036*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Type", "[", "asp1", "]"}]], "Input",
 CellChangeTimes->{{3.662275835474313*^9, 3.662275837169052*^9}}],

Cell[BoxData["\<\"ket\"\>"], "Output",
 CellChangeTimes->{3.662275837540572*^9, 3.662293867741827*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Name", "[", "asp1", "]"}]], "Input",
 CellChangeTimes->{{3.662275769110223*^9, 3.662275771147558*^9}}],

Cell[BoxData["\<\"a\"\>"], "Output",
 CellChangeTimes->{3.662275771475374*^9, 3.662293868594974*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["VecSpace", "Subsubsection",
 CellChangeTimes->{{3.6622834361410313`*^9, 3.6622834387315063`*^9}}],

Cell["\<\
General spaces are just lists of atomic spaces, but with head \
\[OpenCurlyDoubleQuote]VecSpace\[CloseCurlyDoubleQuote]\
\>", "Text",
 CellChangeTimes->{{3.662273714279039*^9, 3.6622737331509333`*^9}, {
  3.662273860425611*^9, 3.6622738647385902`*^9}, {3.662273897278823*^9, 
  3.662273897632307*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"sp1", "=", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"asp1", ",", "asp2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sp2", "=", 
   RowBox[{"VecSpace", "[", "asp3", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"sp1", "//", "TreeForm"}]}], "Input",
 CellChangeTimes->{{3.6622737902613783`*^9, 3.662273822843605*^9}, {
  3.662273899345306*^9, 3.6622738997821503`*^9}, {3.662274941984221*^9, 
  3.6622749499411917`*^9}, {3.6622938824741364`*^9, 3.662293883071697*^9}}],

Cell[BoxData[
 GraphicsBox[
  TagBox[GraphicsComplexBox[{{1.6903085094570331`, 2.53546276418555}, {
    0.8451542547285166, 1.6903085094570334`}, {0.4225771273642583, 
    0.8451542547285167}, {0., 0.}, {0.8451542547285166, 0.}, {
    1.267731382092775, 0.8451542547285167}, {2.53546276418555, 
    1.6903085094570334`}, {2.1128856368212916`, 0.8451542547285167}, {
    1.6903085094570331`, 0.}, {2.53546276418555, 0.}, {2.958039891549808, 
    0.8451542547285167}}, {
     {RGBColor[0.55, 0.45, 0.45], 
      LineBox[{{1, 2}, {1, 7}, {2, 3}, {2, 6}, {3, 4}, {3, 5}, {7, 8}, {7, 
       11}, {8, 9}, {8, 10}}]}, {
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 1],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{
             RowBox[{"AtomicSpace", "[", 
               RowBox[{
                 RowBox[{"System", "[", 
                   RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], 
               "]"}], ",", 
             RowBox[{"AtomicSpace", "[", 
               RowBox[{
                 RowBox[{"System", "[", 
                   RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], 
               "]"}]}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["a", 2], "ket"], 
          $CellContext`AtomicSpace[
           $CellContext`System["b", 4], "bra"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 2],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["a", 2], "ket"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 3],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"a\"", ",", "2"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["a", 2]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"a\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 4],
        TagBox["\"a\"", HoldForm]],
       Annotation[#, 
        HoldForm["a"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["2",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 5],
        TagBox["2", HoldForm]],
       Annotation[#, 
        HoldForm[2], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"ket\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 6],
        TagBox["\"ket\"", HoldForm]],
       Annotation[#, 
        HoldForm["ket"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 7],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["b", 4], "bra"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 8],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"b\"", ",", "4"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["b", 4]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"b\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 9],
        TagBox["\"b\"", HoldForm]],
       Annotation[#, 
        HoldForm["b"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["4",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 10],
        TagBox["4", HoldForm]],
       Annotation[#, 
        HoldForm[4], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"bra\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.03636363636363637],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 11],
        TagBox["\"bra\"", HoldForm]],
       Annotation[#, 
        HoldForm["bra"], "Tooltip"]& ]}}],
   Annotation[#, 
    VertexCoordinateRules -> {{1.6903085094570331`, 2.53546276418555}, {
     0.8451542547285166, 1.6903085094570334`}, {0.4225771273642583, 
     0.8451542547285167}, {0., 0.}, {0.8451542547285166, 0.}, {
     1.267731382092775, 0.8451542547285167}, {2.53546276418555, 
     1.6903085094570334`}, {2.1128856368212916`, 0.8451542547285167}, {
     1.6903085094570331`, 0.}, {2.53546276418555, 0.}, {2.958039891549808, 
     0.8451542547285167}}]& ],
  AspectRatio->NCache[2 11^Rational[-1, 2], 0.6030226891555273],
  FrameTicks->Automatic,
  PlotRange->All,
  PlotRangePadding->Scaled[0.1]]], "Output",
 CellChangeTimes->{
  3.662274950248639*^9, 3.662276183707161*^9, 3.6622919695388403`*^9, {
   3.662293870380364*^9, 3.662293883606895*^9}, 3.662295879355734*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AtomNames", "[", "x_VecSpace", "]"}], ":=", 
   RowBox[{
    RowBox[{"Level", "[", 
     RowBox[{"x", ",", 
      RowBox[{"{", "3", "}"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{";;", ";;", "2"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AtomicQ", "[", "x_VecSpace", "]"}], ":=", 
   RowBox[{
    RowBox[{"Length", "[", "x", "]"}], "\[Equal]", "1"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AtomDimensions", "[", "x_VecSpace", "]"}], ":=", 
   RowBox[{
    RowBox[{"Level", "[", 
     RowBox[{"x", ",", 
      RowBox[{"{", "3", "}"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", ";;", ";;", "2"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Dimension", "[", "x_VecSpace", "]"}], ":=", 
   RowBox[{"Times", "@@", 
    RowBox[{"AtomDimensions", "[", "x", "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.66227585422672*^9, 3.6622758887349653`*^9}, {
  3.662276017892874*^9, 3.662276107302302*^9}, {3.662276314347785*^9, 
  3.662276365048831*^9}, {3.662284834097622*^9, 3.6622848489599524`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AtomNames", "[", "sp1", "]"}]], "Input",
 CellChangeTimes->{{3.662275889789942*^9, 3.662275892231267*^9}, {
  3.662276096547195*^9, 3.662276111273059*^9}, {3.662276378895471*^9, 
  3.6622763803021917`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"a\"\>", ",", "\<\"b\"\>"}], "}"}]], "Output",
 CellChangeTimes->{
  3.662275892511573*^9, {3.662276030310894*^9, 3.662276046674541*^9}, {
   3.662276097648509*^9, 3.66227611161366*^9}, 3.6622763805445223`*^9}]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.662274885329867*^9, 3.6622748913922358`*^9}, 
   3.66229388007088*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AtomNames", "[", "sp1", "]"}]], "Input",
 CellChangeTimes->{{3.662276385107862*^9, 3.6622763878549833`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"a\"\>", ",", "\<\"b\"\>"}], "}"}]], "Output",
 CellChangeTimes->{3.662276388177705*^9}]
}, Open  ]],

Cell["to get the leaves, use Level {-1}", "Text",
 CellChangeTimes->{{3.662274727004858*^9, 3.662274735148239*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Map", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"List", "@@", "#"}], "&"}], ",", "sp1", ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.662275290805478*^9, 3.66227536589331*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.662275291394425*^9, 3.6622753663041162`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Level", "[", 
  RowBox[{"sp1", ",", 
   RowBox[{"{", 
    RowBox[{"-", "1"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.66227393188669*^9, 3.662273950217844*^9}, {
  3.662274181991528*^9, 3.662274190637236*^9}, {3.662274467480071*^9, 
  3.662274474421733*^9}, {3.662274537425928*^9, 3.662274538361134*^9}, {
  3.662274648230628*^9, 3.6622746493873053`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"a\"\>", ",", "2", ",", "\<\"ket\"\>", ",", "\<\"b\"\>", ",", 
   "4", ",", "\<\"bra\"\>"}], "}"}]], "Output",
 CellChangeTimes->{{3.662273939544408*^9, 3.662273950557961*^9}, 
   3.6622740436885223`*^9, {3.6622741848741837`*^9, 3.6622741915409527`*^9}, 
   3.66227447482542*^9, 3.66227453866896*^9, 3.6622746497902193`*^9, 
   3.6622938869331837`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["IndexDict", "Subsubsection",
 CellChangeTimes->{{3.6622834799880457`*^9, 3.6622834814346857`*^9}}],

Cell["\<\
Index dictionary: list of vector spaces. Shouldn\[CloseCurlyQuote]t contain \
AtomicSpaces with the same name and type.\
\>", "Text",
 CellChangeTimes->{{3.662274751420806*^9, 3.662274796747672*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"td1", "=", 
  RowBox[{"IndexDict", "[", 
   RowBox[{"sp1", ",", "sp2"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.662274894401555*^9, 3.662274904677022*^9}, {
  3.662274935802114*^9, 3.662274937479762*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{
   RowBox[{"VecSpace", "[", 
    RowBox[{
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
     ",", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}]}],
     "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.662274937908298*^9, 3.662274952004601*^9}, 
   3.6622762300812674`*^9, 3.6622919820236883`*^9, 3.662293890187468*^9, 
   3.662295885278604*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"td2", "=", 
  RowBox[{"IndexDict", "[", 
   RowBox[{
    RowBox[{"VecSpace", "[", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{"b", ",", "\"\<ket\>\""}], "]"}], "]"}], ",", 
    RowBox[{"VecSpace", "[", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{"d", ",", "\"\<bra\>\""}], "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.66228562638272*^9, 3.662285652038891*^9}, {
  3.662285745015152*^9, 3.66228575723075*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
    "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"d\"\>", ",", "7"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662285654492757*^9, 3.662285757763101*^9, 
  3.6622919963712254`*^9, 3.662293890902166*^9, 3.6622958859931793`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"td1", "//", "TreeForm"}]], "Input",
 CellChangeTimes->{{3.662275454715846*^9, 3.662275456957732*^9}}],

Cell[BoxData[
 GraphicsBox[
  TagBox[GraphicsComplexBox[{{2.803299942217696, 3.2037713625345092`}, {
    1.6018856812672546`, 2.402828521900882}, {0.8009428406336273, 
    1.6018856812672546`}, {0.40047142031681365`, 0.8009428406336272}, {0., 
    0.}, {0.8009428406336273, 0.}, {1.201414260950441, 0.8009428406336272}, {
    2.402828521900882, 1.6018856812672546`}, {2.002357101584068, 
    0.8009428406336272}, {1.6018856812672546`, 0.}, {2.402828521900882, 0.}, {
    2.803299942217696, 0.8009428406336272}, {4.004714203168136, 
    2.402828521900882}, {4.004714203168136, 1.6018856812672546`}, {
    3.604242782851323, 0.8009428406336272}, {3.2037713625345092`, 0.}, {
    4.004714203168136, 0.}, {4.40518562348495, 0.8009428406336272}}, {
     {RGBColor[0.55, 0.45, 0.45], 
      LineBox[{{1, 2}, {1, 13}, {2, 3}, {2, 8}, {3, 4}, {3, 7}, {4, 5}, {4, 
       6}, {8, 9}, {8, 12}, {9, 10}, {9, 11}, {13, 14}, {14, 15}, {14, 18}, {
       15, 16}, {15, 17}}]}, {
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["IndexDict", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 1],
        TagBox[
         RowBox[{"IndexDict", "[", 
           RowBox[{
             RowBox[{"VecSpace", "[", 
               RowBox[{
                 RowBox[{"AtomicSpace", "[", 
                   RowBox[{
                    RowBox[{"System", "[", 
                    RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], 
                   "]"}], ",", 
                 RowBox[{"AtomicSpace", "[", 
                   RowBox[{
                    RowBox[{"System", "[", 
                    RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], 
                   "]"}]}], "]"}], ",", 
             RowBox[{"VecSpace", "[", 
               RowBox[{"AtomicSpace", "[", 
                 RowBox[{
                   RowBox[{"System", "[", 
                    RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], 
                 "]"}], "]"}]}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`IndexDict[
          $CellContext`VecSpace[
           $CellContext`AtomicSpace[
            $CellContext`System["a", 2], "ket"], 
           $CellContext`AtomicSpace[
            $CellContext`System["b", 4], "bra"]], 
          $CellContext`VecSpace[
           $CellContext`AtomicSpace[
            $CellContext`System["a", 2], "bra"]]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 2],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{
             RowBox[{"AtomicSpace", "[", 
               RowBox[{
                 RowBox[{"System", "[", 
                   RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], 
               "]"}], ",", 
             RowBox[{"AtomicSpace", "[", 
               RowBox[{
                 RowBox[{"System", "[", 
                   RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], 
               "]"}]}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["a", 2], "ket"], 
          $CellContext`AtomicSpace[
           $CellContext`System["b", 4], "bra"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 3],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["a", 2], "ket"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 4],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"a\"", ",", "2"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["a", 2]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"a\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 5],
        TagBox["\"a\"", HoldForm]],
       Annotation[#, 
        HoldForm["a"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["2",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 6],
        TagBox["2", HoldForm]],
       Annotation[#, 
        HoldForm[2], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"ket\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 7],
        TagBox["\"ket\"", HoldForm]],
       Annotation[#, 
        HoldForm["ket"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 8],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["b", 4], "bra"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 9],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"b\"", ",", "4"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["b", 4]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"b\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 10],
        TagBox["\"b\"", HoldForm]],
       Annotation[#, 
        HoldForm["b"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["4",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 11],
        TagBox["4", HoldForm]],
       Annotation[#, 
        HoldForm[4], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"bra\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 12],
        TagBox["\"bra\"", HoldForm]],
       Annotation[#, 
        HoldForm["bra"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 13],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{"AtomicSpace", "[", 
             RowBox[{
               RowBox[{"System", "[", 
                 RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], "]"}], 
           "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["a", 2], "bra"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 14],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["a", 2], "bra"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 15],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"a\"", ",", "2"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["a", 2]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"a\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 16],
        TagBox["\"a\"", HoldForm]],
       Annotation[#, 
        HoldForm["a"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["2",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 17],
        TagBox["2", HoldForm]],
       Annotation[#, 
        HoldForm[2], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"bra\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 18],
        TagBox["\"bra\"", HoldForm]],
       Annotation[#, 
        HoldForm["bra"], "Tooltip"]& ]}}],
   Annotation[#, 
    VertexCoordinateRules -> {{2.803299942217696, 3.2037713625345092`}, {
     1.6018856812672546`, 2.402828521900882}, {0.8009428406336273, 
     1.6018856812672546`}, {0.40047142031681365`, 0.8009428406336272}, {0., 
     0.}, {0.8009428406336273, 0.}, {1.201414260950441, 0.8009428406336272}, {
     2.402828521900882, 1.6018856812672546`}, {2.002357101584068, 
     0.8009428406336272}, {1.6018856812672546`, 0.}, {2.402828521900882, 
     0.}, {2.803299942217696, 0.8009428406336272}, {4.004714203168136, 
     2.402828521900882}, {4.004714203168136, 1.6018856812672546`}, {
     3.604242782851323, 0.8009428406336272}, {3.2037713625345092`, 0.}, {
     4.004714203168136, 0.}, {4.40518562348495, 0.8009428406336272}}]& ],
  AspectRatio->NCache[Rational[10, 33]^Rational[1, 2], 0.5504818825631803],
  FrameTicks->Automatic,
  PlotRange->All,
  PlotRangePadding->Scaled[0.1]]], "Output",
 CellChangeTimes->{3.662275457292509*^9, 3.66227623184767*^9, 
  3.6622938916094933`*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Atoms", "[", "x_IndexDict", "]"}], ":=", 
   RowBox[{"Level", "[", 
    RowBox[{"x", ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Atomize", "[", "x_IndexDict", "]"}], ":=", 
   RowBox[{"IndexDict", "@@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"VecSpace", "[", "#", "]"}], "&"}], "/@", 
      RowBox[{"Atoms", "[", "x", "]"}]}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AtomicQ", "[", "x_IndexDict", "]"}], ":=", 
   RowBox[{"And", "@@", 
    RowBox[{"(", 
     RowBox[{"AtomicQ", "/@", "x"}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AtomNames", "[", "x_IndexDict", "]"}], ":=", 
  RowBox[{
   RowBox[{"Level", "[", 
    RowBox[{"x", ",", 
     RowBox[{"{", "4", "}"}]}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{";;", ";;", "2"}], "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.662275584501058*^9, 3.662275630437377*^9}, {
  3.662276278420989*^9, 3.662276304506445*^9}, {3.66228393778132*^9, 
  3.662283986572818*^9}, {3.662284027657468*^9, 3.6622840311987877`*^9}, {
  3.662284171580566*^9, 3.662284203101263*^9}, {3.662284241605627*^9, 
  3.662284242992298*^9}, {3.662284881747169*^9, 3.6622849408670473`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"(", 
  RowBox[{
   RowBox[{
    RowBox[{"VecSpace", "[", "#", "]"}], "&"}], "/@", 
   RowBox[{"Atoms", "[", "td1", "]"}]}], ")"}]], "Input",
 CellChangeTimes->{{3.66228400072742*^9, 3.6622840244410257`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
    "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.662284001518092*^9, 3.662284033901038*^9, 
  3.662293893743438*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AtomicQ", "[", 
  RowBox[{"Atomize", "[", "td1", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.662284898448538*^9, 3.6622849039013233`*^9}, {
  3.662284949638843*^9, 3.6622849524768353`*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{{3.66228490180132*^9, 3.66228490418499*^9}, {
   3.6622849379681168`*^9, 3.66228495281008*^9}, 3.662292023136777*^9, 
   3.6622938946988153`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"(", 
  RowBox[{"AtomicQ", "/@", "td1"}], ")"}]], "Input",
 CellChangeTimes->{{3.662284907010294*^9, 3.6622849182146873`*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{"False", ",", "True"}], "]"}]], "Output",
 CellChangeTimes->{{3.662284915956464*^9, 3.6622849185617447`*^9}, 
   3.662292027138245*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Atomize", "[", "td1", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
    "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662284136538457*^9, 3.6622920290576897`*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Kets", "[", "x_IndexDict", "]"}], ":=", 
  RowBox[{"Select", "[", 
   RowBox[{
    RowBox[{"Atoms", "[", "x", "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "\"\<ket\>\""}], "&"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Bras", "[", "x_IndexDict", "]"}], ":=", 
  RowBox[{"Select", "[", 
   RowBox[{
    RowBox[{"Atoms", "[", "x", "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "\"\<bra\>\""}], "&"}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.662277364878234*^9, 3.662277402647128*^9}, {
  3.6622774571895647`*^9, 3.662277527187682*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Bras", "[", "td1", "]"}]], "Input",
 CellChangeTimes->{{3.662277385293271*^9, 3.662277388732139*^9}, {
  3.662277529296794*^9, 3.662277530964855*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
   ",", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.662277389088193*^9, 3.662277403717992*^9}, {
  3.66227750753788*^9, 3.662277531491848*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Name", "/@", 
  RowBox[{"Bras", "[", "td1", "]"}]}]], "Input",
 CellChangeTimes->{{3.662277555481153*^9, 3.662277562826838*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}]], "Output",
 CellChangeTimes->{{3.662277560234502*^9, 3.662277563169714*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["td1"], "Input",
 CellChangeTimes->{{3.6622775101291933`*^9, 3.6622775111590157`*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{
   RowBox[{"VecSpace", "[", 
    RowBox[{
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
     ",", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}]}],
     "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662277511795182*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SystemMapping", "[", "x_IndexDict", "]"}], ":=", 
   RowBox[{"MapDict", "@@", 
    RowBox[{"(", 
     RowBox[{"Map", "[", 
      RowBox[{"Name", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Kets", "[", "x", "]"}], ",", 
         RowBox[{"Bras", "[", "x", "]"}]}], "}"}], ",", 
       RowBox[{"{", "2", "}"}]}], "]"}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ValidMappingQ", "[", "x_IndexDict", "]"}], ":=", 
   RowBox[{"ValidMappingQ", "[", 
    RowBox[{"SystemMapping", "[", "x", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MappingEqualQ", "[", 
    RowBox[{"x_IndexDict", ",", "y_IndexDict"}], "]"}], ":=", 
   RowBox[{"MappingEqualQ", "[", 
    RowBox[{
     RowBox[{"SystemMapping", "[", "x", "]"}], ",", 
     RowBox[{"SystemMapping", "[", "y", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ComposableQ", "[", 
   RowBox[{"L_IndexDict", ",", "R_IndexDict"}], "]"}], ":=", 
  RowBox[{"ComposableQ", "[", 
   RowBox[{
    RowBox[{"SystemMapping", "@", "L"}], ",", 
    RowBox[{"SystemMapping", "@", "R"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.6622777267420597`*^9, 3.662277734954753*^9}, {
  3.662277838109755*^9, 3.6622778740239677`*^9}, {3.662283522384871*^9, 
  3.662283526764757*^9}, {3.662283887446104*^9, 3.662283896588129*^9}, {
  3.662284343685481*^9, 3.6622843820229263`*^9}, {3.6623060101651697`*^9, 
  3.6623060402591248`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ContractableSystemQ", "[", 
    RowBox[{"x_IndexDict", ",", "sysname_"}], "]"}], ":=", 
   RowBox[{"ContractableSystemQ", "[", 
    RowBox[{
     RowBox[{"SystemMapping", "[", "x", "]"}], ",", "sysname"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ContractableSystemsQ", "[", 
   RowBox[{"x_IndexDict", ",", "sysnames_List"}], "]"}], ":=", 
  RowBox[{"ContractableSystemsQ", "[", 
   RowBox[{
    RowBox[{"SystemMapping", "[", "x", "]"}], ",", "sysnames"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.662355821776307*^9, 3.662355866494525*^9}, {
  3.662356697145512*^9, 3.662356707372759*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SystemMapping", "[", "td1", "]"}]], "Input",
 CellChangeTimes->{{3.662285616193471*^9, 3.662285621781733*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", "\<\"a\"\>", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662285622118638*^9, 3.662291983390345*^9, 
  3.662292014904434*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"td2", "//", "SystemMapping"}]], "Input",
 CellChangeTimes->{{3.662285671140061*^9, 3.662285674526176*^9}, {
  3.662285766874053*^9, 3.662285774503046*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", "\<\"b\"\>", "}"}], ",", 
   RowBox[{"{", "\<\"d\"\>", "}"}]}], "]"}]], "Output",
 CellChangeTimes->{
  3.6622856748739767`*^9, {3.6622857600762033`*^9, 3.662285774884952*^9}, 
   3.6622920158060493`*^9, 3.6622939009920607`*^9}]
}, Open  ]],

Cell["these are for atomic IndexDicts only", "Text",
 CellChangeTimes->{{3.6622844531847973`*^9, 3.662284461875654*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NameSort", "[", 
   RowBox[{"x_IndexDict", "/;", 
    RowBox[{"AtomicQ", "[", "x", "]"}]}], "]"}], ":=", 
  RowBox[{"IndexDict", "@@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"VecSpace", "[", "#", "]"}], "&"}], "/@", 
     RowBox[{"SortBy", "[", 
      RowBox[{
       RowBox[{"Level", "[", 
        RowBox[{"x", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Name", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Type", "[", "#", "]"}], "\[Equal]", "\"\<bra\>\""}], 
          "&"}]}], "}"}]}], "]"}]}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TypeSort", "[", 
   RowBox[{"x_IndexDict", "/;", 
    RowBox[{"AtomicQ", "[", "x", "]"}]}], "]"}], ":=", 
  RowBox[{"IndexDict", "@@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"VecSpace", "[", "#", "]"}], "&"}], "/@", 
     RowBox[{"SortBy", "[", 
      RowBox[{
       RowBox[{"Level", "[", 
        RowBox[{"x", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Type", "[", "#", "]"}], "\[Equal]", "\"\<bra\>\""}], 
          "&"}], ",", "Name"}], "}"}]}], "]"}]}], ")"}]}]}]}], "Input",
 CellChangeTimes->{{3.661937999416551*^9, 3.6619380063816233`*^9}, {
  3.662099885898498*^9, 3.662099888523641*^9}, {3.662113730092189*^9, 
  3.662113731057187*^9}, {3.662113811955566*^9, 3.662113819300243*^9}, {
  3.662223462173745*^9, 3.662223504976098*^9}, {3.662284725123434*^9, 
  3.662284744940628*^9}, {3.6622852282736683`*^9, 3.6622852689775667`*^9}, {
  3.6622853027584763`*^9, 3.662285346010784*^9}}],

Cell["\<\
these as well. all of these are really bad in the sense that they would \
produce syntactically-valid output from non-atomic IndexDicts, but the \
outputs don\[CloseCurlyQuote]t mean anything useful in terms of the original \
object. \
\>", "Text",
 CellChangeTimes->{{3.662285119036172*^9, 3.662285180758026*^9}, {
  3.6622852955321617`*^9, 3.662285296024791*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"KetIndices", "[", "x_IndexDict", "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Position", "[", 
     RowBox[{
      RowBox[{"Atoms", "[", "x", "]"}], ",", 
      RowBox[{"z_", "/;", 
       RowBox[{
        RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<ket\>\""}]}]}], 
     "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BraIndices", "[", "x_IndexDict", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Position", "[", 
    RowBox[{
     RowBox[{"Atoms", "[", "x", "]"}], ",", 
     RowBox[{"z_", "/;", 
      RowBox[{
       RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<bra\>\""}]}]}], 
    "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.662285036857441*^9, 3.662285041474057*^9}, {
  3.662285100756813*^9, 3.6622851067579517`*^9}, {3.662285410178493*^9, 
  3.662285411661463*^9}, {3.662288072022284*^9, 3.662288080729385*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CompositionIndices", "[", 
    RowBox[{"L_IndexDict", ",", "R_IndexDict"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"Atoms", "@", "L"}], ",", 
          RowBox[{"z_", "/;", 
           RowBox[{
            RowBox[{
             RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<bra\>\""}], "&&", 
            RowBox[{
             RowBox[{"Name", "[", "z", "]"}], "\[Equal]", "#"}]}]}]}], "]"}], 
        ",", 
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"Atoms", "@", "R"}], ",", 
          RowBox[{"z_", "/;", 
           RowBox[{
            RowBox[{
             RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<ket\>\""}], "&&", 
            RowBox[{
             RowBox[{"Name", "[", "z", "]"}], "\[Equal]", "#"}]}]}]}], 
         "]"}]}], "}"}], "]"}], "&"}], "/@", 
    RowBox[{"(", 
     RowBox[{"ContractableSystems", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"SystemMapping", "[", "#", "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"L", ",", "R"}], "}"}]}], ")"}]}], ")"}]}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.6622854545424*^9, 3.662285527284487*^9}, {
  3.662285935341673*^9, 3.662285941531919*^9}, {3.662286015969225*^9, 
  3.662286016131527*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ComposeMaps", "[", 
   RowBox[{
    RowBox[{"L_IndexDict", "/;", 
     RowBox[{"AtomicQ", "[", "L", "]"}]}], ",", 
    RowBox[{"R_IndexDict", "/;", 
     RowBox[{"AtomicQ", "[", "R", "]"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ci", "=", 
      RowBox[{"CompositionIndices", "[", 
       RowBox[{"L", ",", "R"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ci", "\[Equal]", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"IndexDict", "@@", 
       RowBox[{"(", 
        RowBox[{"Join", "[", 
         RowBox[{"L", ",", "R"}], "]"}], ")"}]}], ",", 
      RowBox[{"IndexDict", "@@", 
       RowBox[{"(", 
        RowBox[{"Join", "@@", 
         RowBox[{"MapThread", "[", 
          RowBox[{"Delete", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"L", ",", "R"}], "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Transpose", "[", 
                RowBox[{"{", "#", "}"}], "]"}], "&"}], "/@", 
              RowBox[{"Transpose", "[", "ci", "]"}]}]}], "}"}]}], "]"}]}], 
        ")"}]}]}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6622860592464743`*^9, 3.662286074505887*^9}, {
  3.6622861333781967`*^9, 3.662286161900343*^9}, {3.66228623177634*^9, 
  3.66228623891467*^9}, {3.662286352430064*^9, 3.662286423903563*^9}, {
  3.66236132045864*^9, 3.662361321299685*^9}, {3.6623613698075047`*^9, 
  3.662361369882167*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ComposeMaps", "[", 
   RowBox[{
    RowBox[{"Atomize", "[", "td1", "]"}], ",", "td2"}], "]"}], "//", 
  "SystemMapping"}]], "Input",
 CellChangeTimes->{{3.6622861820326242`*^9, 3.662286208261742*^9}, {
  3.6622862468482513`*^9, 3.662286253835956*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", "\<\"a\"\>", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"a\"\>", ",", "\<\"d\"\>"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.662286197712573*^9, 3.662286208670785*^9}, {
   3.6622862416380997`*^9, 3.662286254077393*^9}, 3.66228642768908*^9, 
   3.662288108795383*^9, 3.662292047813611*^9, 3.66229390808491*^9, 
   3.662295906330594*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ComposeMaps", "[", 
   RowBox[{"td2", ",", 
    RowBox[{"Atomize", "[", "td1", "]"}]}], "]"}], "//", 
  "SystemMapping"}]], "Input",
 CellChangeTimes->{{3.662286263676507*^9, 3.662286265805594*^9}, {
  3.6622864325300093`*^9, 3.662286435154825*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"d\"\>", ",", "\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{
  3.662286266278924*^9, {3.662286430390367*^9, 3.6622864354539537`*^9}, 
   3.6622881096933393`*^9, 3.662292049457013*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AtomicQ", "[", "td2", "]"}]], "Input",
 CellChangeTimes->{{3.662286215176207*^9, 3.6622862245837717`*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{{3.662286215976054*^9, 3.662286224912677*^9}, 
   3.662292051094336*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["td1"], "Input",
 CellChangeTimes->{{3.662359991064818*^9, 3.6623599915494347`*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{
   RowBox[{"VecSpace", "[", 
    RowBox[{
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
     ",", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}]}],
     "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662359991853716*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ContractionIndices", "[", 
   RowBox[{"x_IndexDict", ",", "sysnames_List"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"ContractableSystemsQ", "[", 
     RowBox[{"x", ",", "sysnames"}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"atoms", "=", 
        RowBox[{"Atoms", "[", "x", "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"atoms", ",", 
             RowBox[{"z_", "/;", 
              RowBox[{
               RowBox[{
                RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<bra\>\""}], 
               "&&", 
               RowBox[{
                RowBox[{"Name", "[", "z", "]"}], "\[Equal]", "#"}]}]}]}], 
            "]"}], ",", 
           RowBox[{"Position", "[", 
            RowBox[{"atoms", ",", 
             RowBox[{"z_", "/;", 
              RowBox[{
               RowBox[{
                RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<ket\>\""}], 
               "&&", 
               RowBox[{
                RowBox[{"Name", "[", "z", "]"}], "\[Equal]", "#"}]}]}]}], 
            "]"}]}], "}"}], "]"}], "&"}], "/@", 
       RowBox[{"(", "sysnames", ")"}]}]}], "]"}], ",", 
    RowBox[{"{", "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.662360095859105*^9, 3.662360128070984*^9}, {
  3.662360183221491*^9, 3.662360189609373*^9}, {3.662361124665142*^9, 
  3.662361163532271*^9}, {3.662361226508322*^9, 3.662361249086471*^9}, {
  3.662361298861022*^9, 3.66236129956662*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ContractionIndices", "[", 
  RowBox[{"td1", ",", 
   RowBox[{"{", "\"\<b\>\"", "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6623612504717913`*^9, 3.662361264995183*^9}}],

Cell[BoxData[
 RowBox[{"{", "}"}]], "Output",
 CellChangeTimes->{3.66236130884085*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["td2"], "Input",
 CellChangeTimes->{{3.662361380799926*^9, 3.6623613815846233`*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
    "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"d\"\>", ",", "7"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}]}], "]"}]], "Output",
 CellChangeTimes->{3.6623613817889767`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ComposeMaps", "[", 
   RowBox[{"td2", ",", 
    RowBox[{"Atomize", "[", "td1", "]"}]}], "]"}], "//", 
  "SystemMapping"}]], "Input",
 CellChangeTimes->{{3.6623613830264997`*^9, 3.662361427234531*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"d\"\>", ",", "\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{{3.662361386570215*^9, 3.662361427626412*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"?", "ContractableSystemsQ"}]], "Input",
 CellChangeTimes->{{3.662360129733017*^9, 3.6623601335811167`*^9}}],

Cell[CellGroupData[{

Cell["Global`ContractableSystemsQ", "Print", "PrintUsage",
 CellChangeTimes->{3.662360133967434*^9},
 CellTags->"Info-01fa8e2c-9240-44a5-a414-d1b60338b5b9"],

Cell[BoxData[
 InterpretationBox[GridBox[{
    {GridBox[{
       {
        RowBox[{
         RowBox[{"ContractableSystemsQ", "[", 
          RowBox[{"x_MapDict", ",", "sysnames_List"}], "]"}], ":=", 
         RowBox[{"And", "@@", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"SubsetQ", "[", 
              RowBox[{"#1", ",", "sysnames"}], "]"}], "&"}], ")"}], "/@", 
           "x"}]}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{"ContractableSystemsQ", "[", 
          RowBox[{"x_IndexDict", ",", "sysnames_List"}], "]"}], ":=", 
         RowBox[{"ContractableSystemsQ", "[", 
          RowBox[{
           RowBox[{"SystemMapping", "[", "x", "]"}], ",", "sysnames"}], 
          "]"}]}]}
      },
      BaselinePosition->{Baseline, {1, 1}},
      GridBoxAlignment->{
       "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
        "RowsIndexed" -> {}},
      GridBoxItemSize->{"Columns" -> {{
           Scaled[0.999]}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
        "RowsIndexed" -> {}}]}
   },
   BaselinePosition->{Baseline, {1, 1}},
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}}],
  Definition[$CellContext`ContractableSystemsQ],
  Editable->False]], "Print",
 CellChangeTimes->{3.662360133996356*^9},
 CellTags->"Info-01fa8e2c-9240-44a5-a414-d1b60338b5b9"]
}, Open  ]]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ContractMap2", "[", 
   RowBox[{
    RowBox[{"x_IndexDict", "/;", 
     RowBox[{"AtomicQ", "[", "x", "]"}]}], ",", "sysnames_List"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ci", "=", 
      RowBox[{"ContractionIndices", "[", 
       RowBox[{"x", ",", "sysnames"}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ci", "\[Equal]", 
       RowBox[{"{", "}"}]}], ",", ",", 
      RowBox[{"Delete", "[", 
       RowBox[{"x", ",", 
        RowBox[{"Transpose", "[", "ci", "]"}]}], "]"}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.662360043027709*^9, 3.662360073679068*^9}, {
   3.662361451703279*^9, 3.662361485329479*^9}, {3.662361544408017*^9, 
   3.662361550444942*^9}, {3.662361627229534*^9, 3.66236168288904*^9}, {
   3.6623619698204317`*^9, 3.662361997077235*^9}, 3.6623629522515507`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ContractMap", "[", 
   RowBox[{"x_IndexDict", ",", "sysnames_List"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"ContractableSystemsQ", "[", 
     RowBox[{"x", ",", "sysnames"}], "]"}], ",", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"r", "=", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Atoms", "[", "x", "]"}], ",", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"MemberQ", "[", 
             RowBox[{"sysnames", ",", 
              RowBox[{"Name", "[", "#", "]"}]}], "]"}]}], "&"}]}], "]"}]}], 
       "}"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"r", "\[Equal]", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"IndexDict", "[", "]"}], ",", 
        RowBox[{"IndexDict", "[", 
         RowBox[{"VecSpace", "@@", "r"}], "]"}]}], "]"}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.662362249151785*^9, 3.6623623633122168`*^9}, 
   3.662362953642263*^9, {3.662362985179885*^9, 3.662363023306182*^9}, {
   3.662363146491273*^9, 3.6623631541551332`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ContractMap2", "[", 
  RowBox[{"td1", ",", 
   RowBox[{"{", "\"\<a\>\"", "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.662362332685478*^9, 3.662362342910231*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{"VecSpace", "[", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
   "]"}], "]"}]], "Output",
 CellChangeTimes->{{3.662362336997864*^9, 3.662362364628531*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Select", "[", 
  RowBox[{
   RowBox[{"Atoms", "[", "td1", "]"}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"Name", "[", "#", "]"}], "\[Equal]", "\"\<a\>\""}], "&"}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.6623621440865517`*^9, 3.662362238128137*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
   ",", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.662362168833477*^9, 3.6623622384611464`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Atoms", "[", "td1", "]"}]], "Input",
 CellChangeTimes->{{3.662362175144827*^9, 3.6623622124884567`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"a\"\>", ",", "\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}]], "Output",\

 CellChangeTimes->{{3.662362178012404*^9, 3.662362209307403*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"td3", "//", "SystemMapping"}]], "Input",
 CellChangeTimes->{{3.662362472319695*^9, 3.662362477126658*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"\<\"a\"\>", ",", "\<\"b\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.6623624734011707`*^9, 3.662362477519796*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Clear", "[", "ContractMap", "]"}]], "Input",
 CellChangeTimes->{{3.662362961304759*^9, 3.662362964796534*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Atoms", "[", 
  RowBox[{"Atomize", "[", "td3", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.662363122222021*^9, 3.662363124071419*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
   ",", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
   ",", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
   ",", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"ket\"\>"}], "]"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.662363115887526*^9, 3.662363124368681*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ContractMap", "[", 
  RowBox[{
   RowBox[{"Atomize", "[", "td3", "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"\"\<a\>\"", ",", "\"\<b\>\""}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.662362893015929*^9, 3.662362915795855*^9}, 
   3.6623629582869177`*^9}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", "]"}]], "Output",
 CellChangeTimes->{{3.6623629133356123`*^9, 3.662362916424675*^9}, {
   3.6623629587285767`*^9, 3.6623629695495777`*^9}, 3.662363028237274*^9, 
   3.662363091637344*^9, 3.662363159398985*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ContractionIndices", "[", 
  RowBox[{
   RowBox[{"Atomize", "[", "td3", "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"\"\<a\>\"", ",", "\"\<b\>\""}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.662362480932274*^9, 3.662362495500328*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"3", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "4"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.662362495980582*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["MultiMap", "Subsubsection",
 CellChangeTimes->{{3.662288173302196*^9, 3.662288176222569*^9}}],

Cell["\<\
it seems that we have to separately deal with the exceptional case of maps \
from C to C (i.e. numbers). This case is exceptional because the array in the \
second slot of MultiMap is now just a number; it has no dimensions, and so it \
doesn\[CloseCurlyQuote]t work with ArrayReshape.\
\>", "Text",
 CellChangeTimes->{{3.662290829286705*^9, 3.662290898669429*^9}, {
  3.6622909745159397`*^9, 3.662290995466642*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AtomicQ", "[", "t_MultiMap", "]"}], ":=", 
   RowBox[{"And", "[", 
    RowBox[{
     RowBox[{"AtomicQ", "[", 
      RowBox[{"t", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{"List", "@@", 
       RowBox[{"Dimension", "/@", 
        RowBox[{"Atoms", "[", 
         RowBox[{"t", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "\[Equal]", 
      RowBox[{"Dimensions", "[", 
       RowBox[{"t", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"Atomize", "[", "t_MultiMap", "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"AtomicQ", "[", "t", "]"}], ",", "t", ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"atomdict", "=", 
         RowBox[{"Atomize", "[", 
          RowBox[{"t", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"MultiMap", "@@", 
        RowBox[{"{", 
         RowBox[{"atomdict", ",", 
          RowBox[{"ArrayReshape", "[", 
           RowBox[{
            RowBox[{"t", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"List", "@@", 
             RowBox[{"Dimension", "/@", "atomdict"}]}]}], "]"}]}], "}"}]}]}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6622881922312813`*^9, 3.662288270048793*^9}, {
  3.662288314338972*^9, 3.662288330499509*^9}, {3.662288408390126*^9, 
  3.662288448718438*^9}, {3.662288510576621*^9, 3.662288530009214*^9}, {
  3.662291005182624*^9, 3.662291051536075*^9}, {3.662292524152083*^9, 
  3.662292538527424*^9}, {3.66229266931544*^9, 3.662292737637439*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MappingEqualQ", "[", 
    RowBox[{"t1_MultiMap", ",", "t2_MultiMap"}], "]"}], ":=", 
   RowBox[{"MappingEqualQ", "[", 
    RowBox[{
     RowBox[{"t1", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", 
     RowBox[{"t2", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.662305955964693*^9, 3.66230599189777*^9}, {
  3.66230605993688*^9, 3.662306060569738*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ComposableQ", "[", 
    RowBox[{"L_MultiMap", ",", "R_MultiMap"}], "]"}], ":=", 
   RowBox[{"ComposableQ", "[", 
    RowBox[{
     RowBox[{"L", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", 
     RowBox[{"R", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.662290468599729*^9, 3.662290489468749*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ComposeAtomicTensors", "[", 
   RowBox[{"L_MultiMap", ",", "R_MultiMap"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"ComposableQ", "[", 
     RowBox[{
      RowBox[{"L", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"R", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
    RowBox[{"MultiMap", "@@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ComposeMaps", "[", 
        RowBox[{
         RowBox[{"L", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"R", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"Activate", "[", 
        RowBox[{"TensorContract", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Inactive", "[", "TensorProduct", "]"}], "[", 
           RowBox[{
            RowBox[{"L", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"R", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", "+", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"L", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], ")"}], 
            "&"}], "/@", 
           RowBox[{"CompositionIndices", "[", 
            RowBox[{
             RowBox[{"L", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"R", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], "]"}], "]"}]}], 
      "}"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6622885908814297`*^9, 3.66228867682613*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ComposeMaps", "[", 
    RowBox[{"L_MultiMap", ",", "R_MultiMap"}], "]"}], ":=", 
   RowBox[{"ComposeAtomicTensors", "[", 
    RowBox[{
     RowBox[{"Atomize", "[", "L", "]"}], ",", 
     RowBox[{"Atomize", "[", "R", "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.662293355426916*^9, 3.6622933789495277`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Times", "[", 
    RowBox[{
     RowBox[{"MultiMap", "[", 
      RowBox[{"x_", ",", "y_"}], "]"}], ",", 
     RowBox[{"z_", "?", "NumericQ"}]}], "]"}], "^:=", 
   RowBox[{"MultiMap", "[", 
    RowBox[{"x", ",", 
     RowBox[{"z", " ", "y"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NonCommutativeMultiply", "[", 
    RowBox[{
     RowBox[{"MultiMap", "[", 
      RowBox[{"x1_", ",", "x2_"}], "]"}], ",", 
     RowBox[{"MultiMap", "[", 
      RowBox[{"y1_", ",", "y2_"}], "]"}]}], "]"}], "^:=", 
   RowBox[{"ComposeMaps", "[", 
    RowBox[{
     RowBox[{"MultiMap", "[", 
      RowBox[{"x1", ",", "x2"}], "]"}], ",", 
     RowBox[{"MultiMap", "[", 
      RowBox[{"y1", ",", "y2"}], "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6622959148019867`*^9, 3.6622959160974073`*^9}, {
  3.662308706894691*^9, 3.66230873758232*^9}, {3.66230936956709*^9, 
  3.662309392977871*^9}, {3.662309433716281*^9, 3.6623094817382936`*^9}, {
  3.662309644022937*^9, 3.6623096493452787`*^9}, {3.6623098961920137`*^9, 
  3.662309926119502*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ComposeMaps", "[", "x_MultiMap", "]"}], ":=", "x"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.662295930483798*^9, 3.662295937669642*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ComposeMaps", "[", 
    RowBox[{"L_MultiMap", ",", "R_MultiMap"}], "]"}], ":=", 
   RowBox[{"ComposeAtomicTensors", "[", 
    RowBox[{
     RowBox[{"Atomize", "[", "L", "]"}], ",", 
     RowBox[{"Atomize", "[", "R", "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.662293355426916*^9, 3.6622933789495277`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ComposeMaps", "[", 
   RowBox[{"L_MultiMap", ",", "R_MultiMap", ",", "x__MultiMap"}], "]"}], ":=", 
  RowBox[{"ComposeMaps", "[", 
   RowBox[{
    RowBox[{"ComposeMaps", "[", 
     RowBox[{"L", ",", "R"}], "]"}], ",", 
    RowBox[{"ComposeMaps", "[", "x", "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.662295067171647*^9, 3.6622950699992247`*^9}, {
  3.662295109407895*^9, 3.662295165905064*^9}, {3.662295323808297*^9, 
  3.662295326786569*^9}, {3.66229604335984*^9, 3.662296047977756*^9}, {
  3.6622960816698093`*^9, 3.662296095029016*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SystemMapping", "[", "t_MultiMap", "]"}], ":=", 
  RowBox[{"SystemMapping", "[", 
   RowBox[{"t", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6622896955243063`*^9, 3.662289707981903*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"t1", "=", 
   RowBox[{"MultiMap", "[", 
    RowBox[{"td1", ",", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"8", ",", "2"}], "}"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"t2", "=", 
   RowBox[{"MultiMap", "[", 
    RowBox[{"td2", ",", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "7"}], "}"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"testket", "=", 
   RowBox[{"MultiMap", "[", 
    RowBox[{
     RowBox[{"IndexDict", "[", 
      RowBox[{"VecSpace", "[", 
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\"\<a\>\"", ",", "2"}], "]"}], ",", "\"\<ket\>\""}], "]"}],
        "]"}], "]"}], ",", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"testbra", "=", 
   RowBox[{"MultiMap", "[", 
    RowBox[{
     RowBox[{"IndexDict", "[", 
      RowBox[{"VecSpace", "[", 
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\"\<a\>\"", ",", "2"}], "]"}], ",", "\"\<bra\>\""}], "]"}],
        "]"}], "]"}], ",", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trivial", "=", 
   RowBox[{"ComposeAtomicTensors", "[", 
    RowBox[{"testbra", ",", "testket"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.662288358884511*^9, 3.662288385198831*^9}, 
   3.6622926149788437`*^9, {3.662293933802597*^9, 3.6622939368048058`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SystemMapping", "[", "t1", "]"}]], "Input",
 CellChangeTimes->{{3.662289709699367*^9, 3.662289713753622*^9}, {
  3.662292095857153*^9, 3.6622920959486227`*^9}, {3.6622951791372538`*^9, 
  3.662295195537107*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", "\<\"a\"\>", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{
  3.6622897140217867`*^9, {3.6622920944305696`*^9, 3.662292096216507*^9}, 
   3.662293919338749*^9, {3.662295180302114*^9, 3.66229519588542*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["t1"], "Input",
 CellChangeTimes->{{3.662309556256579*^9, 3.662309556460842*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}],
        ",", 
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], 
        "]"}]}], "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0.03418303646773402`", ",", "0.007475138897715894`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.41288792864041746`", ",", "0.011273548931417077`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.3203346283879942`", ",", "0.5883774622213376`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.2932489621720633`", ",", "0.9012374153222418`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.64465209870494`", ",", "0.1324331572896258`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.194547259991124`", ",", "0.7109756508159721`"}], "}"}], ",", 
     
     RowBox[{"{", 
      RowBox[{"0.031179385028779594`", ",", "0.08018290921759985`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.6430448854475015`", ",", "0.8855075112185875`"}], "}"}]}], 
    "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662309556747109*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"t1", " ", "**", "t2"}]], "Input",
 CellChangeTimes->{{3.6623095732964582`*^9, 3.662309584978991*^9}, {
  3.66230985373962*^9, 3.662309857291872*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"d\"\>", ",", "7"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.3653917577954158`", ",", "0.305587604846285`", ",", 
         "0.6361078829482123`", ",", "0.5288638526761479`", ",", 
         "0.5118368613901437`", ",", "0.7117155278747936`", ",", 
         "0.6375801758746977`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.3350022591488624`", ",", "0.47746713585625433`", ",", 
         "0.6453760636053888`", ",", "0.8255996993648604`", ",", 
         "0.760311826905397`", ",", "0.9367207415055668`", ",", 
         "0.6330859921511484`"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.6783574675925962`", ",", "0.5400514874050695`", ",", 
         "1.1343226650555578`", ",", "0.6675083555877079`", ",", 
         "1.0326512403796946`", ",", "1.260204096553355`", ",", 
         "0.857353181769958`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.5830092789710449`", ",", "0.7303320174331541`", ",", 
         "1.3388532833874138`", ",", "0.5992491295208262`", ",", 
         "0.9603973180518824`", ",", "1.6186082085661457`", ",", 
         "1.221689707788781`"}], "}"}]}], "}"}]}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.662309577070546*^9, 3.662309585350746*^9}, {
  3.6623098545296993`*^9, 3.662309857623473*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ComposeMaps", "[", 
  RowBox[{"t1", ",", "t2"}], "]"}]], "Input",
 CellChangeTimes->{{3.6623098622027197`*^9, 3.6623098693970823`*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"d\"\>", ",", "7"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.3653917577954158`", ",", "0.305587604846285`", ",", 
         "0.6361078829482123`", ",", "0.5288638526761479`", ",", 
         "0.5118368613901437`", ",", "0.7117155278747936`", ",", 
         "0.6375801758746977`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.3350022591488624`", ",", "0.47746713585625433`", ",", 
         "0.6453760636053888`", ",", "0.8255996993648604`", ",", 
         "0.760311826905397`", ",", "0.9367207415055668`", ",", 
         "0.6330859921511484`"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.6783574675925962`", ",", "0.5400514874050695`", ",", 
         "1.1343226650555578`", ",", "0.6675083555877079`", ",", 
         "1.0326512403796946`", ",", "1.260204096553355`", ",", 
         "0.857353181769958`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.5830092789710449`", ",", "0.7303320174331541`", ",", 
         "1.3388532833874138`", ",", "0.5992491295208262`", ",", 
         "0.9603973180518824`", ",", "1.6186082085661457`", ",", 
         "1.221689707788781`"}], "}"}]}], "}"}]}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.6623098698766823`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"t1", "//", "SystemMapping"}]], "Input",
 CellChangeTimes->{{3.6623095939823637`*^9, 3.662309598607992*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", "\<\"a\"\>", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662309599263794*^9}]
}, Open  ]],

Cell[BoxData["t"], "Input",
 CellChangeTimes->{3.6623096044350033`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"10", "t1"}]], "Input",
 CellChangeTimes->{{3.662309546915406*^9, 3.6623095523769703`*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}],
        ",", 
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], 
        "]"}]}], "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0.3418303646773402`", ",", "0.07475138897715894`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"4.128879286404175`", ",", "0.11273548931417077`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3.203346283879942`", ",", "5.883774622213376`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2.932489621720633`", ",", "9.012374153222417`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6.4465209870494`", ",", "1.324331572896258`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1.9454725999112399`", ",", "7.109756508159721`"}], "}"}], ",", 
     
     RowBox[{"{", 
      RowBox[{"0.31179385028779594`", ",", "0.8018290921759985`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"6.430448854475015`", ",", "8.855075112185876`"}], "}"}]}], 
    "}"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.662309547731282*^9, 3.6623095539486856`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ComposeMaps", "[", 
  RowBox[{"t1", ",", "t2"}], "]"}]], "Input",
 CellChangeTimes->{{3.662296106348826*^9, 3.662296117587953*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"d\"\>", ",", "7"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.3653917577954158`", ",", "0.305587604846285`", ",", 
         "0.6361078829482123`", ",", "0.5288638526761479`", ",", 
         "0.5118368613901437`", ",", "0.7117155278747936`", ",", 
         "0.6375801758746977`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.3350022591488624`", ",", "0.47746713585625433`", ",", 
         "0.6453760636053888`", ",", "0.8255996993648604`", ",", 
         "0.760311826905397`", ",", "0.9367207415055668`", ",", 
         "0.6330859921511484`"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.6783574675925962`", ",", "0.5400514874050695`", ",", 
         "1.1343226650555578`", ",", "0.6675083555877079`", ",", 
         "1.0326512403796946`", ",", "1.260204096553355`", ",", 
         "0.857353181769958`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.5830092789710449`", ",", "0.7303320174331541`", ",", 
         "1.3388532833874138`", ",", "0.5992491295208262`", ",", 
         "0.9603973180518824`", ",", "1.6186082085661457`", ",", 
         "1.221689707788781`"}], "}"}]}], "}"}]}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.662296110735331*^9, 3.662296117908942*^9}, 
   3.662309515031481*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ComposeMaps", "[", 
   RowBox[{"t2", ",", "t1", ",", "testket"}], "]"}], "//", 
  "SystemMapping"}]], "Input",
 CellChangeTimes->{{3.6622951848101892`*^9, 3.662295199461903*^9}, {
  3.66229541832086*^9, 3.662295419519009*^9}, {3.662296121892027*^9, 
  3.6622961301033278`*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"d\"\>", ",", "\<\"b\"\>"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{
  3.662295200179681*^9, 3.662295329784709*^9, 3.662295445050104*^9, {
   3.662296122220351*^9, 3.662296130394944*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ComposeMaps", "[", 
   RowBox[{"testbra", ",", "t2", ",", "t1", ",", "testket"}], "]"}], "//", 
  "SystemMapping"}]], "Input",
 CellChangeTimes->{{3.6622961616086063`*^9, 3.6622961628023243`*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", "\<\"b\"\>", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"d\"\>", ",", "\<\"b\"\>"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662296163684865*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ComposeMaps", "[", 
  RowBox[{"testbra", ",", "t2", ",", "t1", ",", "testket"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"d\"\>", ",", "7"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.1182511010026756`", ",", "0.09967686036236384`", ",", 
         "0.05475530954221844`", ",", "0.182499723565827`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.03466695512392286`", ",", "0.029221658113757494`", ",", 
         "0.01605228063503309`", ",", "0.053502332522398256`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.1336956766803957`", ",", "0.11269548598301862`", ",", 
         "0.061906807623937354`", ",", "0.20633570283262165`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.09974258746509788`", ",", "0.08407556359846892`", ",", 
         "0.04618507738942456`", ",", "0.1539350964665337`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.14013490426261044`", ",", "0.11812327467260872`", ",", 
         "0.06488844497434967`", ",", "0.2162735151977264`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.10946539864750318`", ",", "0.09227116841179167`", ",", 
         "0.050687154168406086`", ",", "0.16894054113492243`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.07979168543579555`", ",", "0.06725844089249958`", ",", 
         "0.03694695776941183`", ",", "0.12314439706193203`"}], "}"}]}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.07280028749961549`", ",", "0.061365213768918105`", ",", 
         "0.03370964196531031`", ",", "0.11235440711788335`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.05415705361948776`", ",", "0.04565035780211967`", ",", 
         "0.02507702854083767`", ",", "0.08358186292466366`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.14728553737632322`", ",", "0.12415072517695469`", ",", 
         "0.06819949346560492`", ",", "0.22730925656087617`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.043772428903785486`", ",", "0.03689689353053384`", ",", 
         "0.02026850383394987`", ",", "0.06755502576305752`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.06977788031513661`", ",", "0.05881754988815061`", ",", 
         "0.03231013837045566`", ",", "0.10768985455986291`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.14436679991636636`", ",", "0.12169044714348473`", ",", 
         "0.06684799338030094`", ",", "0.22280469994291033`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.14736269064361715`", ",", "0.12421575962809592`", ",", 
         "0.06823521872310401`", ",", "0.2274283290247598`"}], "}"}]}], "}"}],
      ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.052003684498342466`", ",", "0.04383522820605638`", ",", 
         "0.024079926680582706`", ",", "0.08025851738274509`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.0024847262059835198`", ",", "0.0020944389098493175`", ",", 
         "0.0011505343407602715`", ",", "0.0038347367752499684`"}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{
        "0.018429309054048562`", ",", "0.01553453329042308`", ",", 
         "0.00853355709458304`", ",", "0.028442388944834897`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.15340458375991164`", ",", "0.12930862499146864`", ",", 
         "0.0710328732480815`", ",", "0.23675292570240997`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.06602100161831455`", ",", "0.055650781290765644`", ",", 
         "0.030570543100620465`", ",", "0.10189177472951227`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.010290294714086327`", ",", "0.0086739511142509`", ",", 
         "0.004764845887884818`", ",", "0.015881255437014102`"}], "}"}], ",", 
       
       RowBox[{"{", 
        RowBox[{
        "0.038127552878876494`", ",", "0.03213868397031183`", ",", 
         "0.01765468517644455`", ",", "0.058843154961229244`"}], "}"}]}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.022510351588007994`", ",", "0.018974547830170475`", ",", 
         "0.010423254064058633`", ",", "0.034740758499052636`"}], "}"}], ",", 
       
       RowBox[{"{", 
        RowBox[{
        "0.08058091869284935`", ",", "0.06792370567641821`", ",", 
         "0.037312406470731044`", ",", "0.12436243943126285`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.09743247847729716`", ",", "0.0821283139826396`", ",", 
         "0.045115398277511445`", ",", "0.15036985057786306`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.04228206571170445`", ",", "0.03564062849345054`", ",", 
         "0.019578402031761328`", ",", "0.06525491296697186`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.08729832645287178`", ",", "0.07358597951247886`", ",", 
         "0.040422853122834564`", ",", "0.1347295738502083`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.15373171218928314`", ",", "0.12958436986401983`", ",", 
         "0.07118434768052581`", ",", "0.23725779075165349`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.08287775229256425`", ",", "0.06985976513001423`", ",", 
         "0.03837593851105015`", ",", "0.127907197099229`"}], "}"}]}], 
      "}"}]}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662296167793541*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Atomize", "[", "testbra", "]"}]], "Input",
 CellChangeTimes->{{3.662292593273962*^9, 3.66229260452563*^9}, {
  3.662292741531993*^9, 3.662292742895256*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{"VecSpace", "[", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
     "]"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.4508668438711587`", ",", "0.10299298351299213`"}], "}"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{{3.662292597436954*^9, 3.6622926047693367`*^9}, 
   3.662292743502097*^9, 3.662293920609573*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"genPerm", "[", 
    RowBox[{"list1_", ",", "list2_"}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Position", "[", 
       RowBox[{"list1", ",", "#"}], "]"}], "&"}], "/@", "list2"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SortMap", "[", 
   RowBox[{
    RowBox[{"x_IndexDict", "/;", 
     RowBox[{"AtomicQ", "[", "x", "]"}]}], ",", "f_"}], "]"}], ":=", 
  RowBox[{"genPerm", "[", 
   RowBox[{
    RowBox[{"List", "@@", 
     RowBox[{"(", 
      RowBox[{"f", "[", "x", "]"}], ")"}]}], ",", 
    RowBox[{"List", "@@", "x"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.6618579032086782`*^9, 3.661857950955736*^9}, {
  3.661858267770702*^9, 3.661858291501759*^9}, {3.6619659812975273`*^9, 
  3.661965981752877*^9}, {3.662136366258006*^9, 3.6621363677168713`*^9}, {
  3.662292249016747*^9, 3.662292249591618*^9}, {3.662292391260453*^9, 
  3.662292441581807*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SortMap", "[", 
  RowBox[{
   RowBox[{"Atomize", "[", "td1", "]"}], ",", "TypeSort"}], "]"}]], "Input",
 CellChangeTimes->{{3.6622898887933807`*^9, 3.662289901837141*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", "3", ",", "2"}], "}"}]], "Output",
 CellChangeTimes->{
  3.662289902332583*^9, 3.662292105918124*^9, {3.662292225048972*^9, 
   3.6622922522613077`*^9}, 3.662292455318821*^9, 3.662293947787376*^9}]
}, Open  ]],

Cell["Canonical is kets then bras, i.e. Type sorted. ", "Text",
 CellChangeTimes->{{3.6622912375718327`*^9, 3.662291248725424*^9}, {
  3.6622931703217907`*^9, 3.662293183179882*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Canonicalize", "[", "t_MultiMap", "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"t", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "0"}], ",", "t", 
     ",", 
     RowBox[{
      RowBox[{
       RowBox[{"MultiMap", "@@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"TypeSort", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"SortMap", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "TypeSort"}], "]"}]}], 
           "]"}]}], "}"}]}], "&"}], "[", 
      RowBox[{"Atomize", "[", "t", "]"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AddMaps", "[", 
    RowBox[{"t1_MultiMap", ",", "t2_MultiMap"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"MappingEqualQ", "[", 
      RowBox[{"t1", ",", "t2"}], "]"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ct1", "=", 
         RowBox[{"Canonicalize", "[", "t1", "]"}]}], "}"}], ",", 
       RowBox[{"MultiMap", "[", 
        RowBox[{
         RowBox[{"ct1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"ct1", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "+", 
          RowBox[{
           RowBox[{"Canonicalize", "[", "t2", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Plus", "[", 
   RowBox[{
    RowBox[{"MultiMap", "[", 
     RowBox[{"x1_", ",", "y1_"}], "]"}], ",", 
    RowBox[{"MultiMap", "[", 
     RowBox[{"x2_", ",", "y2_"}], "]"}]}], "]"}], "^:=", 
  RowBox[{"AddMaps", "[", 
   RowBox[{
    RowBox[{"MultiMap", "[", 
     RowBox[{"x1", ",", "y1"}], "]"}], ",", 
    RowBox[{"MultiMap", "[", 
     RowBox[{"x2", ",", "y2"}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.662136655948927*^9, 3.662136659994413*^9}, {
   3.662137672201889*^9, 3.662137690588224*^9}, {3.662138098451522*^9, 
   3.662138103950452*^9}, {3.66213814869676*^9, 3.662138150881999*^9}, {
   3.662289931361678*^9, 3.662289970269702*^9}, {3.662290035554151*^9, 
   3.662290126779221*^9}, {3.662290156790887*^9, 3.662290163845595*^9}, {
   3.662290198535327*^9, 3.662290245608856*^9}, {3.662290676923354*^9, 
   3.66229074104944*^9}, {3.6622912588542557`*^9, 3.662291278665625*^9}, {
   3.662291331458407*^9, 3.662291398258482*^9}, {3.6622916460335503`*^9, 
   3.662291702298497*^9}, {3.662292883970436*^9, 3.6622929062778482`*^9}, {
   3.662293017585043*^9, 3.662293020142514*^9}, {3.662293068104684*^9, 
   3.6622930798458014`*^9}, 3.662293114378652*^9, {3.662307101059758*^9, 
   3.662307119533021*^9}, {3.662314945678759*^9, 3.6623149496262712`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Matrixize", "[", "t_MultiMap", "]"}], ":=", "\[IndentingNewLine]", 
  
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ct", ",", "keti", ",", "brai"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ct", "=", 
      RowBox[{"Canonicalize", "[", "t", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"keti", "=", 
      RowBox[{"KetIndices", "[", 
       RowBox[{"ct", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"brai", "=", 
      RowBox[{"BraIndices", "[", 
       RowBox[{"ct", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"keti", "\[Equal]", 
         RowBox[{"{", "}"}]}], "&&", 
        RowBox[{"brai", "\[Equal]", 
         RowBox[{"{", "}"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"MultiMap", "[", 
        RowBox[{
         RowBox[{"IndexDict", "[", "]"}], ",", 
         RowBox[{"ct", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"keti", "\[Equal]", 
         RowBox[{"{", "}"}]}], "||", 
        RowBox[{"brai", "==", 
         RowBox[{"{", "}"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"MultiMap", "[", 
        RowBox[{
         RowBox[{"IndexDict", "[", 
          RowBox[{"VecSpace", "@@", 
           RowBox[{"Atoms", "[", 
            RowBox[{"ct", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"Flatten", "[", 
          RowBox[{"ct", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "True", ",", "\[IndentingNewLine]", 
       RowBox[{"MultiMap", "@@", 
        RowBox[{"(", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"IndexDict", "@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"VecSpace", "@@", "#"}], "&"}], "/@", 
              RowBox[{"SplitBy", "[", 
               RowBox[{
                RowBox[{"Atoms", "[", 
                 RowBox[{"ct", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "Type"}], 
               "]"}]}], ")"}]}], ",", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"ct", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"keti", ",", "brai"}], "}"}]}], "]"}]}], "}"}], 
         ")"}]}]}], "]"}]}]}], "]"}]}]], "Input"],

Cell[CellGroupData[{

Cell[BoxData["t1"], "Input",
 CellChangeTimes->{{3.662306967975779*^9, 3.662306968253862*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}],
        ",", 
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], 
        "]"}]}], "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0.03418303646773402`", ",", "0.007475138897715894`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.41288792864041746`", ",", "0.011273548931417077`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.3203346283879942`", ",", "0.5883774622213376`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.2932489621720633`", ",", "0.9012374153222418`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.64465209870494`", ",", "0.1324331572896258`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.194547259991124`", ",", "0.7109756508159721`"}], "}"}], ",", 
     
     RowBox[{"{", 
      RowBox[{"0.031179385028779594`", ",", "0.08018290921759985`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.6430448854475015`", ",", "0.8855075112185875`"}], "}"}]}], 
    "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662306968546138*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"t1", "//", "Head"}]], "Input",
 CellChangeTimes->{{3.6623069803365107`*^9, 3.66230698203052*^9}}],

Cell[BoxData["MultiMap"], "Output",
 CellChangeTimes->{3.6623069822185717`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SplitBy", "[", 
  RowBox[{
   RowBox[{"Atoms", "[", 
    RowBox[{"t1", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "Type"}], "]"}]], "Input",
 CellChangeTimes->{{3.662306926667336*^9, 3.662306943976622*^9}, {
  3.6623070549330797`*^9, 3.662307096419344*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
     ",", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}]}],
     "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.662307077276223*^9, 3.662307096833127*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Canonicalize", "[", "trivial", "]"}]], "Input",
 CellChangeTimes->{{3.662291846638589*^9, 3.662291866782065*^9}, {
  3.662292791707412*^9, 3.662292844431148*^9}, {3.662292944791232*^9, 
  3.662292945522334*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", "]"}], ",", "0.4112673235568372`"}], 
  "]"}]], "Output",
 CellChangeTimes->{{3.6622918472897663`*^9, 3.662291867107068*^9}, 
   3.662292482336954*^9, 3.662292543540511*^9, 3.662292755846681*^9, {
   3.662292793678884*^9, 3.662292844759837*^9}, 3.6622929459308643`*^9, 
   3.662293959444418*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ComposeMaps", "[", 
   RowBox[{"t2", ",", "t1"}], "]"}], "//", "SystemMapping"}]], "Input",
 CellChangeTimes->{{3.662293329248728*^9, 3.662293333507574*^9}, {
  3.662293389643173*^9, 3.662293405259886*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"d\"\>", ",", "\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{
  3.6622933339296494`*^9, {3.662293386727515*^9, 3.6622934055874043`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Matrixize", "[", 
    RowBox[{"ComposeMaps", "[", 
     RowBox[{"t2", ",", "t1"}], "]"}], "]"}], "[", 
   RowBox[{"[", "2", "]"}], "]"}], "//", "SingularValueList"}]], "Input",
 CellChangeTimes->{{3.662293411064724*^9, 3.662293423735879*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "5.6995598664361875`", ",", "2.051125839476113`", ",", 
   "1.8417323278936444`", ",", "1.0819971020553276`", ",", 
   "0.6627923656679156`", ",", "0.5968662669079199`", ",", 
   "0.3893830868122174`", ",", "0.2147969056305355`"}], "}"}]], "Output",
 CellChangeTimes->{{3.662293417520509*^9, 3.662293424060772*^9}, 
   3.662293976174303*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"td1", "//", "TreeForm"}]], "Input",
 CellChangeTimes->{{3.6623543086659727`*^9, 3.662354312808247*^9}}],

Cell[BoxData[
 GraphicsBox[
  TagBox[GraphicsComplexBox[{{2.803299942217696, 3.2037713625345092`}, {
    1.6018856812672546`, 2.402828521900882}, {0.8009428406336273, 
    1.6018856812672546`}, {0.40047142031681365`, 0.8009428406336272}, {0., 
    0.}, {0.8009428406336273, 0.}, {1.201414260950441, 0.8009428406336272}, {
    2.402828521900882, 1.6018856812672546`}, {2.002357101584068, 
    0.8009428406336272}, {1.6018856812672546`, 0.}, {2.402828521900882, 0.}, {
    2.803299942217696, 0.8009428406336272}, {4.004714203168136, 
    2.402828521900882}, {4.004714203168136, 1.6018856812672546`}, {
    3.604242782851323, 0.8009428406336272}, {3.2037713625345092`, 0.}, {
    4.004714203168136, 0.}, {4.40518562348495, 0.8009428406336272}}, {
     {RGBColor[0.55, 0.45, 0.45], 
      LineBox[{{1, 2}, {1, 13}, {2, 3}, {2, 8}, {3, 4}, {3, 7}, {4, 5}, {4, 
       6}, {8, 9}, {8, 12}, {9, 10}, {9, 11}, {13, 14}, {14, 15}, {14, 18}, {
       15, 16}, {15, 17}}]}, {
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["IndexDict", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 1],
        TagBox[
         RowBox[{"IndexDict", "[", 
           RowBox[{
             RowBox[{"VecSpace", "[", 
               RowBox[{
                 RowBox[{"AtomicSpace", "[", 
                   RowBox[{
                    RowBox[{"System", "[", 
                    RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], 
                   "]"}], ",", 
                 RowBox[{"AtomicSpace", "[", 
                   RowBox[{
                    RowBox[{"System", "[", 
                    RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], 
                   "]"}]}], "]"}], ",", 
             RowBox[{"VecSpace", "[", 
               RowBox[{"AtomicSpace", "[", 
                 RowBox[{
                   RowBox[{"System", "[", 
                    RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], 
                 "]"}], "]"}]}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`IndexDict[
          $CellContext`VecSpace[
           $CellContext`AtomicSpace[
            $CellContext`System["a", 2], "ket"], 
           $CellContext`AtomicSpace[
            $CellContext`System["b", 4], "bra"]], 
          $CellContext`VecSpace[
           $CellContext`AtomicSpace[
            $CellContext`System["a", 2], "bra"]]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 2],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{
             RowBox[{"AtomicSpace", "[", 
               RowBox[{
                 RowBox[{"System", "[", 
                   RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], 
               "]"}], ",", 
             RowBox[{"AtomicSpace", "[", 
               RowBox[{
                 RowBox[{"System", "[", 
                   RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], 
               "]"}]}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["a", 2], "ket"], 
          $CellContext`AtomicSpace[
           $CellContext`System["b", 4], "bra"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 3],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["a", 2], "ket"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 4],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"a\"", ",", "2"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["a", 2]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"a\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 5],
        TagBox["\"a\"", HoldForm]],
       Annotation[#, 
        HoldForm["a"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["2",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 6],
        TagBox["2", HoldForm]],
       Annotation[#, 
        HoldForm[2], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"ket\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 7],
        TagBox["\"ket\"", HoldForm]],
       Annotation[#, 
        HoldForm["ket"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 8],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["b", 4], "bra"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 9],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"b\"", ",", "4"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["b", 4]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"b\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 10],
        TagBox["\"b\"", HoldForm]],
       Annotation[#, 
        HoldForm["b"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["4",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 11],
        TagBox["4", HoldForm]],
       Annotation[#, 
        HoldForm[4], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"bra\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 12],
        TagBox["\"bra\"", HoldForm]],
       Annotation[#, 
        HoldForm["bra"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 13],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{"AtomicSpace", "[", 
             RowBox[{
               RowBox[{"System", "[", 
                 RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], "]"}], 
           "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["a", 2], "bra"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 14],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["a", 2], "bra"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 15],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"a\"", ",", "2"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["a", 2]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"a\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 16],
        TagBox["\"a\"", HoldForm]],
       Annotation[#, 
        HoldForm["a"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["2",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 17],
        TagBox["2", HoldForm]],
       Annotation[#, 
        HoldForm[2], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"bra\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.024242424242424246`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 18],
        TagBox["\"bra\"", HoldForm]],
       Annotation[#, 
        HoldForm["bra"], "Tooltip"]& ]}}],
   Annotation[#, 
    VertexCoordinateRules -> {{2.803299942217696, 3.2037713625345092`}, {
     1.6018856812672546`, 2.402828521900882}, {0.8009428406336273, 
     1.6018856812672546`}, {0.40047142031681365`, 0.8009428406336272}, {0., 
     0.}, {0.8009428406336273, 0.}, {1.201414260950441, 0.8009428406336272}, {
     2.402828521900882, 1.6018856812672546`}, {2.002357101584068, 
     0.8009428406336272}, {1.6018856812672546`, 0.}, {2.402828521900882, 
     0.}, {2.803299942217696, 0.8009428406336272}, {4.004714203168136, 
     2.402828521900882}, {4.004714203168136, 1.6018856812672546`}, {
     3.604242782851323, 0.8009428406336272}, {3.2037713625345092`, 0.}, {
     4.004714203168136, 0.}, {4.40518562348495, 0.8009428406336272}}]& ],
  AspectRatio->NCache[Rational[10, 33]^Rational[1, 2], 0.5504818825631803],
  FrameTicks->Automatic,
  PlotRange->All,
  PlotRangePadding->Scaled[0.1]]], "Output",
 CellChangeTimes->{{3.662354309780587*^9, 3.662354313114232*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Type", "[", 
  RowBox[{"AtomicSpace", "[", 
   RowBox[{
    RowBox[{"System", "[", 
     RowBox[{"\"\<testname\>\"", ",", "32"}], "]"}], ",", "\"\<ket\>\""}], 
   "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.662355243517211*^9, 3.662355262891148*^9}}],

Cell[BoxData["\<\"ket\"\>"], "Output",
 CellChangeTimes->{{3.662355260239459*^9, 3.662355263297463*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["PartialTranspose", "Subsubsection",
 CellChangeTimes->{{3.662314967776133*^9, 3.662314982680852*^9}, {
  3.662353696029086*^9, 3.6623536975832777`*^9}, {3.66235384556551*^9, 
  3.6623538680571327`*^9}, {3.662353901494738*^9, 3.662353910552404*^9}}],

Cell["supports lists of system names\.7f, as in qmatrix. ", "Text",
 CellChangeTimes->{{3.662317203281437*^9, 3.662317222537278*^9}, {
  3.66235391756842*^9, 3.662353921343062*^9}, {3.662356869933182*^9, 
  3.662356884381978*^9}}],

Cell["\<\
partial transpose swaps ket and bra for a given system in the index list. \
actually it renames one to the other.\
\>", "Text",
 CellChangeTimes->{{3.6623539261691732`*^9, 3.662353941582762*^9}, {
  3.662355606352157*^9, 3.662355617750403*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"KetAddress", "[", 
    RowBox[{"x_IndexDict", ",", "sysname_"}], "]"}], ":=", 
   RowBox[{"Position", "[", 
    RowBox[{"x", ",", 
     RowBox[{"z_", "/;", 
      RowBox[{
       RowBox[{
        RowBox[{"Name", "[", "z", "]"}], "\[Equal]", "sysname"}], "&&", 
       RowBox[{
        RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<ket\>\""}]}]}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BraAddress", "[", 
   RowBox[{"x_IndexDict", ",", "sysname_"}], "]"}], ":=", 
  RowBox[{"Position", "[", 
   RowBox[{"x", ",", 
    RowBox[{"z_", "/;", 
     RowBox[{
      RowBox[{
       RowBox[{"Name", "[", "z", "]"}], "\[Equal]", "sysname"}], "&&", 
      RowBox[{
       RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<bra\>\""}]}]}], ",", 
    
    RowBox[{"{", "2", "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.662355132838443*^9, 3.6623552390220623`*^9}, {
  3.662355269154657*^9, 3.662355305342429*^9}, {3.6623554807610273`*^9, 
  3.662355488339485*^9}, {3.662356186813036*^9, 3.662356187598337*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"KetAddresses", "[", 
    RowBox[{"x_IndexDict", ",", "sysnames_List"}], "]"}], ":=", 
   RowBox[{"Position", "[", 
    RowBox[{"x", ",", 
     RowBox[{"z_", "/;", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{"sysnames", ",", 
         RowBox[{"Name", "[", "z", "]"}]}], "]"}], "&&", 
       RowBox[{
        RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<ket\>\""}]}]}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BraAddresses", "[", 
   RowBox[{"x_IndexDict", ",", "sysnames_List"}], "]"}], ":=", 
  RowBox[{"Position", "[", 
   RowBox[{"x", ",", 
    RowBox[{"z_", "/;", 
     RowBox[{
      RowBox[{"MemberQ", "[", 
       RowBox[{"sysnames", ",", 
        RowBox[{"Name", "[", "z", "]"}]}], "]"}], "&&", 
      RowBox[{
       RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<bra\>\""}]}]}], ",", 
    
    RowBox[{"{", "2", "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.662356226722086*^9, 3.662356302612831*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PartialTranspose", "[", 
   RowBox[{"x_IndexDict", ",", "sysnames_List"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"ContractableSystemsQ", "[", 
     RowBox[{"x", ",", "sysnames"}], "]"}], ",", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"k", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"KetAddresses", "[", 
           RowBox[{"x", ",", "sysnames"}], "]"}]}]}], ",", 
        RowBox[{"b", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"BraAddresses", "[", 
           RowBox[{"x", ",", "sysnames"}], "]"}]}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"x", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"k", "\[Rule]", "\"\<bra\>\""}], ",", 
          RowBox[{"b", "\[Rule]", "\"\<ket\>\""}]}], "}"}]}], "]"}]}], 
     "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.662355523755808*^9, 3.662355533985358*^9}, {
  3.662355567925948*^9, 3.6623555979944677`*^9}, {3.662355637595202*^9, 
  3.6623556871494007`*^9}, {3.6623557335939074`*^9, 3.66235573545934*^9}, {
  3.662355782929557*^9, 3.662355787478046*^9}, {3.662355884828128*^9, 
  3.6623558986421843`*^9}, {3.662355951050602*^9, 3.662356001561554*^9}, {
  3.662356334230172*^9, 3.662356336185402*^9}, {3.662356594877863*^9, 
  3.662356644240643*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PartialTranspose", "[", 
   RowBox[{"x_MultiMap", ",", "sysnames_List"}], "]"}], ":=", 
  RowBox[{"MultiMap", "[", 
   RowBox[{
    RowBox[{"PartialTranspose", "[", 
     RowBox[{
      RowBox[{"x", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "sysnames"}], "]"}], ",", 
    RowBox[{"x", "[", 
     RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6623554596170387`*^9, 3.662355519850944*^9}, {
  3.6623569811617947`*^9, 3.6623569836443033`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"td3", "=", 
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\"\<a\>\"", ",", "2"}], "]"}], ",", "\"\<ket\>\""}], "]"}],
        ",", 
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\"\<b\>\"", ",", "4"}], "]"}], ",", "\"\<bra\>\""}], 
        "]"}]}], "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\"\<a\>\"", ",", "2"}], "]"}], ",", "\"\<bra\>\""}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\"\<b\>\"", ",", "4"}], "]"}], ",", "\"\<ket\>\""}], "]"}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.662356741850328*^9, 3.662356771045*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"td3", "//", "TreeForm"}]], "Input",
 CellChangeTimes->{{3.662356772550918*^9, 3.662356777530696*^9}}],

Cell[BoxData[
 GraphicsBox[
  TagBox[GraphicsComplexBox[CompressedData["
1:eJxTTMoPSmViYGCQAGIQnbZD60HEDi4H+5+qDP4H2KH0d/v3VTIO1hcYofzn
9jBxCH3d3gEqzoAG7NHEIeZ8hKtHNfe7fV+5/oGkDX/h8jBxVP2MDjC+uJWi
gusJFgeYeoh+XgeYOhgfZg7Mf6jms8PNg6mH8aOlpQLMQgTg6iH2icDNh/Fh
5jffkjNw8BF2QPWfIJp7ReD81TOVBbxcxODqAaF/fkY=
    "], {
     {RGBColor[0.55, 0.45, 0.45], 
      LineBox[{{1, 2}, {1, 13}, {1, 19}, {2, 3}, {2, 8}, {3, 4}, {3, 7}, {4, 
       5}, {4, 6}, {8, 9}, {8, 12}, {9, 10}, {9, 11}, {13, 14}, {14, 15}, {14,
        18}, {15, 16}, {15, 17}, {19, 20}, {20, 21}, {20, 24}, {21, 22}, {21, 
       23}}]}, {
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["IndexDict", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 1],
        TagBox[
         RowBox[{"IndexDict", "[", 
           RowBox[{
             RowBox[{"VecSpace", "[", 
               RowBox[{
                 RowBox[{"AtomicSpace", "[", 
                   RowBox[{
                    RowBox[{"System", "[", 
                    RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], 
                   "]"}], ",", 
                 RowBox[{"AtomicSpace", "[", 
                   RowBox[{
                    RowBox[{"System", "[", 
                    RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], 
                   "]"}]}], "]"}], ",", 
             RowBox[{"VecSpace", "[", 
               RowBox[{"AtomicSpace", "[", 
                 RowBox[{
                   RowBox[{"System", "[", 
                    RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], 
                 "]"}], "]"}], ",", 
             RowBox[{"VecSpace", "[", 
               RowBox[{"AtomicSpace", "[", 
                 RowBox[{
                   RowBox[{"System", "[", 
                    RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"ket\""}], 
                 "]"}], "]"}]}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`IndexDict[
          $CellContext`VecSpace[
           $CellContext`AtomicSpace[
            $CellContext`System["a", 2], "ket"], 
           $CellContext`AtomicSpace[
            $CellContext`System["b", 4], "bra"]], 
          $CellContext`VecSpace[
           $CellContext`AtomicSpace[
            $CellContext`System["a", 2], "bra"]], 
          $CellContext`VecSpace[
           $CellContext`AtomicSpace[
            $CellContext`System["b", 4], "ket"]]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 2],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{
             RowBox[{"AtomicSpace", "[", 
               RowBox[{
                 RowBox[{"System", "[", 
                   RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], 
               "]"}], ",", 
             RowBox[{"AtomicSpace", "[", 
               RowBox[{
                 RowBox[{"System", "[", 
                   RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], 
               "]"}]}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["a", 2], "ket"], 
          $CellContext`AtomicSpace[
           $CellContext`System["b", 4], "bra"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 3],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["a", 2], "ket"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 4],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"a\"", ",", "2"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["a", 2]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"a\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 5],
        TagBox["\"a\"", HoldForm]],
       Annotation[#, 
        HoldForm["a"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["2",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 6],
        TagBox["2", HoldForm]],
       Annotation[#, 
        HoldForm[2], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"ket\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 7],
        TagBox["\"ket\"", HoldForm]],
       Annotation[#, 
        HoldForm["ket"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 8],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["b", 4], "bra"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 9],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"b\"", ",", "4"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["b", 4]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"b\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 10],
        TagBox["\"b\"", HoldForm]],
       Annotation[#, 
        HoldForm["b"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["4",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 11],
        TagBox["4", HoldForm]],
       Annotation[#, 
        HoldForm[4], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"bra\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 12],
        TagBox["\"bra\"", HoldForm]],
       Annotation[#, 
        HoldForm["bra"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 13],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{"AtomicSpace", "[", 
             RowBox[{
               RowBox[{"System", "[", 
                 RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], "]"}], 
           "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["a", 2], "bra"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 14],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["a", 2], "bra"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 15],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"a\"", ",", "2"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["a", 2]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"a\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 16],
        TagBox["\"a\"", HoldForm]],
       Annotation[#, 
        HoldForm["a"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["2",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 17],
        TagBox["2", HoldForm]],
       Annotation[#, 
        HoldForm[2], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"bra\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 18],
        TagBox["\"bra\"", HoldForm]],
       Annotation[#, 
        HoldForm["bra"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 19],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{"AtomicSpace", "[", 
             RowBox[{
               RowBox[{"System", "[", 
                 RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"ket\""}], "]"}], 
           "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["b", 4], "ket"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 20],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"ket\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["b", 4], "ket"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 21],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"b\"", ",", "4"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["b", 4]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"b\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 22],
        TagBox["\"b\"", HoldForm]],
       Annotation[#, 
        HoldForm["b"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["4",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 23],
        TagBox["4", HoldForm]],
       Annotation[#, 
        HoldForm[4], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"ket\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 24],
        TagBox["\"ket\"", HoldForm]],
       Annotation[#, 
        HoldForm["ket"], "Tooltip"]& ]}}],
   Annotation[#, VertexCoordinateRules -> CompressedData["
1:eJxTTMoPSmViYGCQAGIQnbZD60HEDi4H+5+qDP4H2KH0d/v3VTIO1hcYofzn
9jBxCH3d3gEqzoAG7NHEIeZ8hKtHNfe7fV+5/oGkDX/h8jBxVP2MDjC+uJWi
gusJFgeYeoh+XgeYOhgfZg7Mf6jms8PNg6mH8aOlpQLMQgTg6iH2icDNh/Fh
5jffkjNw8BF2QPWfIJp7ReD81TOVBbxcxODqAaF/fkY=
     "]]& ],
  AspectRatio->NCache[Rational[5, 22]^Rational[1, 2], 0.4767312946227962],
  FrameTicks->Automatic,
  PlotRange->All,
  PlotRangePadding->Scaled[0.1]]], "Output",
 CellChangeTimes->{3.662356777880952*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"PartialTranspose", "[", 
   RowBox[{"td3", ",", 
    RowBox[{"{", 
     RowBox[{"\"\<a\>\"", ",", "\"\<b\>\""}], "}"}]}], "]"}], "//", 
  "TreeForm"}]], "Input",
 CellChangeTimes->{{3.662356795119165*^9, 3.6623568295277023`*^9}, {
  3.662358760424263*^9, 3.662358761070283*^9}}],

Cell[BoxData[
 GraphicsBox[
  TagBox[GraphicsComplexBox[CompressedData["
1:eJxTTMoPSmViYGCQAGIQnbZD60HEDi4H+5+qDP4H2KH0d/v3VTIO1hcYofzn
9jBxCH3d3gEqzoAG7NHEIeZ8hKtHNfe7fV+5/oGkDX/h8jBxVP2MDjC+uJWi
gusJFgeYeoh+XgeYOhgfZg7Mf6jms8PNg6mH8aOlpQLMQgTg6iH2icDNh/Fh
5jffkjNw8BF2QPWfIJp7ReD81TOVBbxcxODqAaF/fkY=
    "], {
     {RGBColor[0.55, 0.45, 0.45], 
      LineBox[{{1, 2}, {1, 13}, {1, 19}, {2, 3}, {2, 8}, {3, 4}, {3, 7}, {4, 
       5}, {4, 6}, {8, 9}, {8, 12}, {9, 10}, {9, 11}, {13, 14}, {14, 15}, {14,
        18}, {15, 16}, {15, 17}, {19, 20}, {20, 21}, {20, 24}, {21, 22}, {21, 
       23}}]}, {
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["IndexDict", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 1],
        TagBox[
         RowBox[{"IndexDict", "[", 
           RowBox[{
             RowBox[{"VecSpace", "[", 
               RowBox[{
                 RowBox[{"AtomicSpace", "[", 
                   RowBox[{
                    RowBox[{"System", "[", 
                    RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], 
                   "]"}], ",", 
                 RowBox[{"AtomicSpace", "[", 
                   RowBox[{
                    RowBox[{"System", "[", 
                    RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"ket\""}], 
                   "]"}]}], "]"}], ",", 
             RowBox[{"VecSpace", "[", 
               RowBox[{"AtomicSpace", "[", 
                 RowBox[{
                   RowBox[{"System", "[", 
                    RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], 
                 "]"}], "]"}], ",", 
             RowBox[{"VecSpace", "[", 
               RowBox[{"AtomicSpace", "[", 
                 RowBox[{
                   RowBox[{"System", "[", 
                    RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], 
                 "]"}], "]"}]}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`IndexDict[
          $CellContext`VecSpace[
           $CellContext`AtomicSpace[
            $CellContext`System["a", 2], "bra"], 
           $CellContext`AtomicSpace[
            $CellContext`System["b", 4], "ket"]], 
          $CellContext`VecSpace[
           $CellContext`AtomicSpace[
            $CellContext`System["a", 2], "ket"]], 
          $CellContext`VecSpace[
           $CellContext`AtomicSpace[
            $CellContext`System["b", 4], "bra"]]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 2],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{
             RowBox[{"AtomicSpace", "[", 
               RowBox[{
                 RowBox[{"System", "[", 
                   RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], 
               "]"}], ",", 
             RowBox[{"AtomicSpace", "[", 
               RowBox[{
                 RowBox[{"System", "[", 
                   RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"ket\""}], 
               "]"}]}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["a", 2], "bra"], 
          $CellContext`AtomicSpace[
           $CellContext`System["b", 4], "ket"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 3],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"bra\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["a", 2], "bra"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 4],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"a\"", ",", "2"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["a", 2]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"a\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 5],
        TagBox["\"a\"", HoldForm]],
       Annotation[#, 
        HoldForm["a"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["2",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 6],
        TagBox["2", HoldForm]],
       Annotation[#, 
        HoldForm[2], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"bra\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 7],
        TagBox["\"bra\"", HoldForm]],
       Annotation[#, 
        HoldForm["bra"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 8],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"ket\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["b", 4], "ket"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 9],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"b\"", ",", "4"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["b", 4]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"b\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 10],
        TagBox["\"b\"", HoldForm]],
       Annotation[#, 
        HoldForm["b"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["4",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 11],
        TagBox["4", HoldForm]],
       Annotation[#, 
        HoldForm[4], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"ket\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 12],
        TagBox["\"ket\"", HoldForm]],
       Annotation[#, 
        HoldForm["ket"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 13],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{"AtomicSpace", "[", 
             RowBox[{
               RowBox[{"System", "[", 
                 RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], "]"}], 
           "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["a", 2], "ket"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 14],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"a\"", ",", "2"}], "]"}], ",", "\"ket\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["a", 2], "ket"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 15],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"a\"", ",", "2"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["a", 2]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"a\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 16],
        TagBox["\"a\"", HoldForm]],
       Annotation[#, 
        HoldForm["a"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["2",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 17],
        TagBox["2", HoldForm]],
       Annotation[#, 
        HoldForm[2], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"ket\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 18],
        TagBox["\"ket\"", HoldForm]],
       Annotation[#, 
        HoldForm["ket"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["VecSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 19],
        TagBox[
         RowBox[{"VecSpace", "[", 
           RowBox[{"AtomicSpace", "[", 
             RowBox[{
               RowBox[{"System", "[", 
                 RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], "]"}], 
           "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`VecSpace[
          $CellContext`AtomicSpace[
           $CellContext`System["b", 4], "bra"]]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["AtomicSpace", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 20],
        TagBox[
         RowBox[{"AtomicSpace", "[", 
           RowBox[{
             RowBox[{"System", "[", 
               RowBox[{"\"b\"", ",", "4"}], "]"}], ",", "\"bra\""}], "]"}], 
         HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`AtomicSpace[
          $CellContext`System["b", 4], "bra"]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox["System", "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 21],
        TagBox[
         RowBox[{"System", "[", 
           RowBox[{"\"b\"", ",", "4"}], "]"}], HoldForm]],
       Annotation[#, 
        HoldForm[
         $CellContext`System["b", 4]], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"b\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 22],
        TagBox["\"b\"", HoldForm]],
       Annotation[#, 
        HoldForm["b"], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["4",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 23],
        TagBox["4", HoldForm]],
       Annotation[#, 
        HoldForm[4], "Tooltip"]& ], 
      TagBox[
       TooltipBox[InsetBox[
         FrameBox[
          StyleBox[
           TagBox["\<\"bra\"\>",
            HoldForm], "StandardForm", "Output",
           StripOnInput->False,
           LineColor->GrayLevel[0],
           FrontFaceColor->GrayLevel[0],
           BackFaceColor->GrayLevel[0],
           GraphicsColor->GrayLevel[0],
           FontSize->Scaled[0.018181818181818184`],
           FontColor->GrayLevel[0]],
          Background->RGBColor[1., 1., 0.871],
          FrameStyle->GrayLevel[0.5],
          StripOnInput->False], 24],
        TagBox["\"bra\"", HoldForm]],
       Annotation[#, 
        HoldForm["bra"], "Tooltip"]& ]}}],
   Annotation[#, VertexCoordinateRules -> CompressedData["
1:eJxTTMoPSmViYGCQAGIQnbZD60HEDi4H+5+qDP4H2KH0d/v3VTIO1hcYofzn
9jBxCH3d3gEqzoAG7NHEIeZ8hKtHNfe7fV+5/oGkDX/h8jBxVP2MDjC+uJWi
gusJFgeYeoh+XgeYOhgfZg7Mf6jms8PNg6mH8aOlpQLMQgTg6iH2icDNh/Fh
5jffkjNw8BF2QPWfIJp7ReD81TOVBbxcxODqAaF/fkY=
     "]]& ],
  AspectRatio->NCache[Rational[5, 22]^Rational[1, 2], 0.4767312946227962],
  FrameTicks->Automatic,
  PlotRange->All,
  PlotRangePadding->Scaled[0.1]]], "Output",
 CellChangeTimes->{{3.6623568082393417`*^9, 3.6623568303654957`*^9}, 
   3.662358764057774*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Adjoint, Transpose", "Subsubsection",
 CellChangeTimes->{{3.662353904351493*^9, 3.66235390897954*^9}}],

Cell["\<\
Transpose, just interchanging kets to bras, is a hack for the actual \
transpose of the map; if the map goes from U to V, then the transpose goes \
from V* to U*. Interchanging kets / bras gives a map from V to U again, which \
has the same action as the actual transpose, once we identify a basis in U \
with one in U* and same for V. \
\>", "Text",
 CellChangeTimes->{{3.662352805304204*^9, 3.662352899726013*^9}, {
  3.662353853433405*^9, 3.662353853734701*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"KetAddresses", "[", "x_IndexDict", "]"}], ":=", 
   RowBox[{"Position", "[", 
    RowBox[{"x", ",", 
     RowBox[{"z_", "/;", 
      RowBox[{
       RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<ket\>\""}]}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BraAddresses", "[", "x_IndexDict", "]"}], ":=", 
  RowBox[{"Position", "[", 
   RowBox[{"x", ",", 
    RowBox[{"z_", "/;", 
     RowBox[{
      RowBox[{"Type", "[", "z", "]"}], "\[Equal]", "\"\<bra\>\""}]}], ",", 
    RowBox[{"{", "2", "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.662353839590477*^9, 3.662353859985257*^9}, {
  3.662357169982345*^9, 3.662357184025537*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MapTranspose", "[", "x_MultiMap", "]"}], ":=", 
  RowBox[{"MultiMap", "[", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"k", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"KetAddresses", "[", 
           RowBox[{"x", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ",", 
        RowBox[{"b", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"BraAddresses", "[", 
           RowBox[{"x", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{
        RowBox[{"x", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"k", "\[Rule]", "\"\<bra\>\""}], ",", 
          RowBox[{"b", "\[Rule]", "\"\<ket\>\""}]}], "}"}]}], "]"}]}], "]"}], 
    ",", 
    RowBox[{"x", "[", 
     RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.662357679884903*^9, 3.6623576860041447`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Transpose", "[", 
   RowBox[{"MultiMap", "[", 
    RowBox[{"x_", ",", "y_"}], "]"}], "]"}], "^:=", 
  RowBox[{"MapTranspose", "[", 
   RowBox[{"MultiMap", "[", 
    RowBox[{"x", ",", "y"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.662357695824801*^9, 3.662357720581913*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Adjoint", "[", "x_MultiMap", "]"}], ":=", 
  RowBox[{"MultiMap", "[", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"k", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"KetAddresses", "[", 
           RowBox[{"x", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ",", 
        RowBox[{"b", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "/@", 
          RowBox[{"BraAddresses", "[", 
           RowBox[{"x", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{
        RowBox[{"x", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"k", "\[Rule]", "\"\<bra\>\""}], ",", 
          RowBox[{"b", "\[Rule]", "\"\<ket\>\""}]}], "}"}]}], "]"}]}], "]"}], 
    ",", 
    RowBox[{"Conjugate", "[", 
     RowBox[{"x", "[", 
      RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.662357394705241*^9, 3.6623574022076483`*^9}, {
  3.6623575031099787`*^9, 3.6623575304482193`*^9}, {3.662357578021434*^9, 
  3.662357580683126*^9}}],

Cell[CellGroupData[{

Cell[BoxData["t1"], "Input",
 CellChangeTimes->{{3.662357548894925*^9, 3.662357560152375*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}],
        ",", 
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], 
        "]"}]}], "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0.03418303646773402`", ",", "0.007475138897715894`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.41288792864041746`", ",", "0.011273548931417077`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.3203346283879942`", ",", "0.5883774622213376`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.2932489621720633`", ",", "0.9012374153222418`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.64465209870494`", ",", "0.1324331572896258`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.194547259991124`", ",", "0.7109756508159721`"}], "}"}], ",", 
     
     RowBox[{"{", 
      RowBox[{"0.031179385028779594`", ",", "0.08018290921759985`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.6430448854475015`", ",", "0.8855075112185875`"}], "}"}]}], 
    "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662357551727066*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Transpose", "[", "t1", "]"}], "==", 
  RowBox[{"Adjoint", "[", "t1", "]"}]}]], "Input",
 CellChangeTimes->{{3.662357566806119*^9, 3.662357569668256*^9}, {
  3.662357724932043*^9, 3.6623577802063932`*^9}, {3.662357813804171*^9, 
  3.662357816305764*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{{3.662357761441311*^9, 3.662357780420045*^9}, {
  3.6623578144446383`*^9, 3.662357816716119*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"KetAddresses", "[", "td3", "]"}]], "Input",
 CellChangeTimes->{{3.6623571955384398`*^9, 3.662357199471943*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.662357199891726*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["PartialTrace", "Subsubsection",
 CellChangeTimes->{{3.6623538704187193`*^9, 3.662353877178216*^9}}],

Cell["need to port the composition stuff to contraction here. ", "Text",
 CellChangeTimes->{{3.662357323058565*^9, 3.6623573359230747`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PartialTrace", "[", 
   RowBox[{
    RowBox[{"x_MultiMap", "/;", 
     RowBox[{"AtomicQ", "[", "x", "]"}]}], ",", "sysnames_List"}], "]"}], ":=",
   "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"ContractableSystemsQ", "[", 
     RowBox[{
      RowBox[{"x", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "sysnames"}], "]"}], ",", 
    RowBox[{"MultiMap", "[", 
     RowBox[{
      RowBox[{"ContractMap", "[", 
       RowBox[{
        RowBox[{"x", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", "sysnames"}], "]"}], ",", 
      RowBox[{"TensorContract", "[", 
       RowBox[{
        RowBox[{"x", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"ContractionIndices", "[", 
         RowBox[{
          RowBox[{"x", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "sysnames"}], "]"}]}], 
       "]"}]}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.66235697615275*^9, 3.6623569782965603`*^9}, {
  3.6623572402073717`*^9, 3.662357276752718*^9}, {3.662362416677477*^9, 
  3.6623624391770477`*^9}, {3.662362505118751*^9, 3.662362520858632*^9}, {
  3.662362587621859*^9, 3.6623625881204987`*^9}, {3.662362768718589*^9, 
  3.662362801597911*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Constructors", "Subsubsection",
 CellChangeTimes->{{3.6623149632115507`*^9, 3.6623149649293823`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"basisElement", "[", 
    RowBox[{"sys_", ",", "num_", ",", "type_"}], "]"}], ":=", 
   RowBox[{"MultiMap", "@@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"IndexDict", "[", 
       RowBox[{"VecSpace", "[", 
        RowBox[{"AtomicSpace", "[", 
         RowBox[{"sys", ",", "type"}], "]"}], "]"}], "]"}], ",", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"num", "+", "1"}], "\[Rule]", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Dimension", "[", "sys", "]"}], "}"}]}], "]"}]}], "}"}]}]}], 
  ";", 
  RowBox[{
   RowBox[{"basisKet", "[", 
    RowBox[{"sys_", ",", "num_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"basisElement", "[", 
    RowBox[{"sys", ",", "num", ",", "\"\<ket\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"basisBra", "[", 
    RowBox[{"sys_", ",", "num_"}], "]"}], ":=", 
   RowBox[{"basisElement", "[", 
    RowBox[{"sys", ",", "num", ",", "\"\<bra\>\""}], "]"}]}], ";"}]}], "Input",\

 CellChangeTimes->{{3.66220111921696*^9, 3.662201182031851*^9}, {
  3.662201269539467*^9, 3.662201309035111*^9}, {3.6622013427522297`*^9, 
  3.662201414358947*^9}, {3.6622090320445642`*^9, 3.662209033252091*^9}, {
  3.662265800448331*^9, 3.662265812996097*^9}, {3.6622658443718653`*^9, 
  3.66226588147587*^9}, {3.662265951474318*^9, 3.6622659765837812`*^9}, {
  3.662266048354597*^9, 3.662266066262542*^9}, {3.662266170275037*^9, 
  3.662266172357874*^9}, {3.6622943261219673`*^9, 3.662294329544879*^9}, {
  3.662294367370594*^9, 3.662294409887745*^9}}],

Cell["\<\
we can use some transpose trickery to generate the entangled state easily. it\
\[CloseCurlyQuote]s just the KroneckerDelta representation of the identity \
matrix on a compound state space mapped over to omega by reordering the \
tensor factors. (obviously)\
\>", "Text",
 CellChangeTimes->{{3.66213448007098*^9, 3.662134501350657*^9}, {
  3.662134534708893*^9, 3.662134541553357*^9}, {3.6621361321422653`*^9, 
  3.6621361768579273`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"OmegaKet", "[", 
    RowBox[{"sys1_System", ",", "sys2_System"}], "]"}], ":=", 
   RowBox[{"MultiMap", "[", 
    RowBox[{
     RowBox[{"IndexDict", "[", 
      RowBox[{
       RowBox[{"VectorSpace", "[", 
        RowBox[{"AtomicSpace", "[", 
         RowBox[{"sys1", ",", "\"\<ket\>\""}], "]"}], "]"}], ",", 
       RowBox[{"VectorSpace", "[", 
        RowBox[{"AtomicSpace", "[", 
         RowBox[{"sys2", ",", "\"\<ket\>\""}], "]"}], "]"}]}], "]"}], ",", 
     RowBox[{"SparseArray", "@", 
      RowBox[{"Flatten", "[", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Dimension", "@", "sys1"}], "]"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OmegaBra", "[", 
    RowBox[{"sys1_System", ",", "sys2_System"}], "]"}], ":=", 
   RowBox[{"MultiMap", "[", 
    RowBox[{
     RowBox[{"IndexDict", "[", 
      RowBox[{
       RowBox[{"VectorSpace", "[", 
        RowBox[{"AtomicSpace", "[", 
         RowBox[{"sys1", ",", "\"\<bra\>\""}], "]"}], "]"}], ",", 
       RowBox[{"VectorSpace", "[", 
        RowBox[{"AtomicSpace", "[", 
         RowBox[{"sys2", ",", "\"\<bra\>\""}], "]"}], "]"}]}], "]"}], ",", 
     RowBox[{"SparseArray", "@", 
      RowBox[{"Flatten", "[", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Dimension", "@", "sys1"}], "]"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"OmegaOp", "[", 
   RowBox[{"sys1_", ",", "sys2_"}], "]"}], ":=", 
  RowBox[{"MultiMap", "[", 
   RowBox[{
    RowBox[{"IndexDict", "[", 
     RowBox[{
      RowBox[{"VectorSpace", "[", 
       RowBox[{
        RowBox[{"AtomicSpace", "[", 
         RowBox[{"sys1", ",", "\"\<ket\>\""}], "]"}], ",", 
        RowBox[{"AtomicSpace", "[", 
         RowBox[{"sys1", ",", "\"\<bra\>\""}], "]"}]}], "]"}], ",", 
      RowBox[{"VectorSpace", "[", 
       RowBox[{
        RowBox[{"AtomicSpace", "[", 
         RowBox[{"sys2", ",", "\"\<ket\>\""}], "]"}], ",", 
        RowBox[{"AtomicSpace", "[", 
         RowBox[{"sys2", ",", "\"\<bra\>\""}], "]"}]}], "]"}]}], "]"}], ",", 
    RowBox[{"SparseArray", "[", 
     RowBox[{"IdentityMatrix", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Dimension", "@", "sys1"}], ")"}], "^", "2"}], "]"}], "]"}]}],
    "]"}]}]}], "Input",
 CellChangeTimes->{{3.662138474701107*^9, 3.6621385362775517`*^9}, {
  3.662138569835249*^9, 3.662138577771708*^9}, {3.66231613006485*^9, 
  3.662316237897751*^9}, {3.662316289397749*^9, 3.662316341015576*^9}, {
  3.662316392427185*^9, 3.662316452901371*^9}, {3.662316493294669*^9, 
  3.662316499919531*^9}, {3.662370475715887*^9, 3.662370481333123*^9}, {
  3.66237053602264*^9, 3.662370541767529*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Swap", "[", 
   RowBox[{"sys1_System", ",", "sys2_System"}], "]"}], ":=", 
  "PartialTranspose"}]], "Input",
 CellChangeTimes->{{3.662445248359036*^9, 3.6624452689320717`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"?", "Swap"}]], "Input",
 CellChangeTimes->{{3.662445251499598*^9, 3.662445253138887*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Information", "::", "notfound"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Symbol \[NoBreak]\\!\\(\\\"Swap\\\"\\)\[NoBreak] not \
found. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/notfound\\\", ButtonNote -> \
\\\"Information::notfound\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.6624452535838337`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimension", "[", "c", "]"}]], "Input",
 CellChangeTimes->{{3.6623162538555098`*^9, 3.662316260698319*^9}}],

Cell[BoxData["2"], "Output",
 CellChangeTimes->{{3.662316256586269*^9, 3.662316261159309*^9}, 
   3.662395006908586*^9}]
}, Open  ]],

Cell["\<\
constructing MultiMaps from matrix representatives. The matrices act to the \
right...\
\>", "Text",
 CellChangeTimes->{{3.662445171403713*^9, 3.6624451897333117`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"fromMatrix", "[", 
   RowBox[{"systems_List", ",", "matrix_"}], "]"}], ":=", 
  RowBox[{"MultiMap", "[", 
   RowBox[{
    RowBox[{"IndexDict", "[", 
     RowBox[{
      RowBox[{"VecSpace", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"AtomicSpace", "[", 
           RowBox[{"#", ",", "\"\<ket\>\""}], "]"}], "&"}], "/@", "systems"}],
         ")"}]}], ",", 
      RowBox[{"VecSpace", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"AtomicSpace", "[", 
           RowBox[{"#", ",", "\"\<bra\>\""}], "]"}], "&"}], "/@", "systems"}],
         ")"}]}]}], "]"}], ",", 
    RowBox[{"SparseArray", "@", "matrix"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6624451396827927`*^9, 3.66244514156351*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"fromMatrix", "[", 
   RowBox[{"sysout_List", ",", "sysin_List", ",", "matrix_"}], "]"}], ":=", 
  RowBox[{"MultiMap", "[", 
   RowBox[{
    RowBox[{"IndexDict", "[", 
     RowBox[{
      RowBox[{"VecSpace", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"AtomicSpace", "[", 
           RowBox[{"#", ",", "\"\<ket\>\""}], "]"}], "&"}], "/@", "sysout"}], 
        ")"}]}], ",", 
      RowBox[{"VecSpace", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"AtomicSpace", "[", 
           RowBox[{"#", ",", "\"\<bra\>\""}], "]"}], "&"}], "/@", "sysin"}], 
        ")"}]}]}], "]"}], ",", 
    RowBox[{"SparseArray", "@", "matrix"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.662445127311335*^9, 3.662445166753706*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Matrixize", "[", 
  RowBox[{"makeOmegaOp", "[", 
   RowBox[{"a", ",", 
    RowBox[{"b", "[", "1", "]"}]}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.662316242351322*^9, 3.6623162675470543`*^9}, {
  3.662316437332749*^9, 3.6623164384287777`*^9}, {3.662316470379985*^9, 
  3.662316478128377*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}],
        ",", 
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"b[1]\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], 
        "]"}]}], "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}],
        ",", 
       RowBox[{"AtomicSpace", "[", 
        RowBox[{
         RowBox[{"System", "[", 
          RowBox[{"\<\"b[1]\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], 
        "]"}]}], "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{
  3.662316268310186*^9, {3.662316439077839*^9, 3.662316482568872*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeOmegaOp", "[", 
   RowBox[{"sys1_", ",", "sys2_"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"makeSpace", "[", 
         RowBox[{"sys1", ",", "\"\<ket\>\""}], "]"}], ",", 
        RowBox[{"makeSpace", "[", 
         RowBox[{"sys1", ",", "\"\<bra\>\""}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"makeSpace", "[", 
         RowBox[{"sys2", ",", "\"\<ket\>\""}], "]"}], ",", 
        RowBox[{"makeSpace", "[", 
         RowBox[{"sys2", ",", "\"\<bra\>\""}], "]"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"IdentityMatrix", "[", 
     RowBox[{
      RowBox[{"sys1", "[", "\"\<dim\>\"", "]"}], "^", "2"}], "]"}]}], 
   "}"}]}]], "Input",
 CellChangeTimes->{{3.6621340230456953`*^9, 3.662134036634068*^9}, {
  3.662134180306136*^9, 3.662134321900798*^9}, {3.662134374804929*^9, 
  3.662134379573085*^9}, {3.6621361088904867`*^9, 3.66213611314983*^9}, {
  3.6621384808654613`*^9, 3.6621384810960712`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"basisElement", "[", 
  RowBox[{"a", ",", "1", ",", "\"\<ket\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.662294415808429*^9, 3.662294423494542*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{"VecSpace", "[", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
     "]"}], "]"}], ",", 
   TagBox[
    TemplateBox[{RowBox[{
        StyleBox[
         TagBox["SparseArray", "SummaryHead"], "NonInterpretableSummary"], 
        StyleBox["[", "NonInterpretableSummary"], 
        DynamicModuleBox[{Typeset`open$$ = False}, 
         PanelBox[
          PaneSelectorBox[{False -> GridBox[{{
                PaneBox[
                 ButtonBox[
                  DynamicBox[
                   FEPrivate`FrontEndResource[
                   "FEBitmaps", "SquarePlusIconMedium"]], 
                  ButtonFunction :> (Typeset`open$$ = True), Appearance -> 
                  None, Evaluator -> Automatic, Method -> "Preemptive"], 
                 Alignment -> {Center, Center}, ImageSize -> 
                 Dynamic[{
                   Automatic, 
                    3.5 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                    Magnification])}]], 
                GraphicsBox[
                 
                 RasterBox[{{{0.235431, 0.32765, 0.833291}, {0.772061, 
                  0.92462, 0.998703}}}, {{0, 0}, {2, 1}}, {0, 1}], 
                 AspectRatio -> 1, Axes -> False, Frame -> False, 
                 FrameLabel -> {None, None}, FrameStyle -> Directive[
                   Opacity[0.5], 
                   Thickness[Tiny], 
                   RGBColor[0.368417, 0.506779, 0.709798]], 
                 FrameTicks -> {{None, None}, {None, None}}, GridLinesStyle -> 
                 Directive[
                   GrayLevel[0.5, 0.4]], ImageSize -> 
                 Dynamic[{
                   Automatic, 
                    3.5 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                    Magnification])}], 
                 Method -> {
                  "AxisPadding" -> Scaled[0.02], "DefaultBoundaryStyle" -> 
                   Automatic, "DefaultPlotStyle" -> Automatic, 
                   "DomainPadding" -> Scaled[0.02], "RangePadding" -> 
                   Scaled[0.05]}], 
                GridBox[{{
                   RowBox[{
                    TagBox[
                    "\"Specified elements: \"", "SummaryItemAnnotation"], 
                    "\[InvisibleSpace]", 
                    TagBox["1", "SummaryItem"]}]}, {
                   RowBox[{
                    TagBox["\"Dimensions: \"", "SummaryItemAnnotation"], 
                    "\[InvisibleSpace]", 
                    TagBox[
                    RowBox[{"{", "2", "}"}], "SummaryItem"]}]}}, 
                 GridBoxAlignment -> {
                  "Columns" -> {{Left}}, "Rows" -> {{Automatic}}}, AutoDelete -> 
                 False, GridBoxItemSize -> {
                  "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
                 GridBoxSpacings -> {
                  "Columns" -> {{2}}, "Rows" -> {{Automatic}}}, 
                 BaseStyle -> {
                  ShowStringCharacters -> False, NumberMarks -> False, 
                   PrintPrecision -> 3, ShowSyntaxStyles -> False}]}}, 
              GridBoxAlignment -> {"Rows" -> {{Top}}}, AutoDelete -> False, 
              GridBoxItemSize -> {
               "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
              BaselinePosition -> {1, 1}], True -> GridBox[{{
                PaneBox[
                 ButtonBox[
                  DynamicBox[
                   FEPrivate`FrontEndResource[
                   "FEBitmaps", "SquareMinusIconMedium"]], 
                  ButtonFunction :> (Typeset`open$$ = False), Appearance -> 
                  None, Evaluator -> Automatic, Method -> "Preemptive"], 
                 Alignment -> {Center, Center}, ImageSize -> 
                 Dynamic[{
                   Automatic, 
                    3.5 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                    Magnification])}]], 
                GraphicsBox[
                 
                 RasterBox[{{{0.235431, 0.32765, 0.833291}, {0.772061, 
                  0.92462, 0.998703}}}, {{0, 0}, {2, 1}}, {0, 1}], 
                 AspectRatio -> 1, Axes -> False, Frame -> False, 
                 FrameLabel -> {None, None}, FrameStyle -> Directive[
                   Opacity[0.5], 
                   Thickness[Tiny], 
                   RGBColor[0.368417, 0.506779, 0.709798]], 
                 FrameTicks -> {{None, None}, {None, None}}, GridLinesStyle -> 
                 Directive[
                   GrayLevel[0.5, 0.4]], ImageSize -> 
                 Dynamic[{
                   Automatic, 
                    3.5 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                    Magnification])}], 
                 Method -> {
                  "AxisPadding" -> Scaled[0.02], "DefaultBoundaryStyle" -> 
                   Automatic, "DefaultPlotStyle" -> Automatic, 
                   "DomainPadding" -> Scaled[0.02], "RangePadding" -> 
                   Scaled[0.05]}], 
                GridBox[{{
                   RowBox[{
                    TagBox[
                    "\"Specified elements: \"", "SummaryItemAnnotation"], 
                    "\[InvisibleSpace]", 
                    TagBox["1", "SummaryItem"]}]}, {
                   RowBox[{
                    TagBox["\"Dimensions: \"", "SummaryItemAnnotation"], 
                    "\[InvisibleSpace]", 
                    TagBox[
                    RowBox[{"{", "2", "}"}], "SummaryItem"]}]}, {
                   RowBox[{
                    TagBox["\"Default: \"", "SummaryItemAnnotation"], 
                    "\[InvisibleSpace]", 
                    TagBox["0", "SummaryItem"]}]}, {
                   RowBox[{
                    TagBox["\"Density: \"", "SummaryItemAnnotation"], 
                    "\[InvisibleSpace]", 
                    TagBox["0.5`", "SummaryItem"]}]}, {
                   RowBox[{
                    TagBox["\"Elements:\"", "SummaryItemAnnotation"], 
                    "\[InvisibleSpace]", 
                    TagBox["\"\"", "SummaryItem"]}]}, {
                   TagBox[
                    TagBox[
                    GridBox[{{
                    RowBox[{
                    RowBox[{"{", "2", "}"}], "\[Rule]", 
                    StyleBox[
                    PaneBox[
                    "1", ContentPadding -> False, FrameMargins -> 0, 
                    StripOnInput -> True, BaselinePosition -> Baseline, 
                    ImageSize -> {{1, 300}, Automatic}], LineBreakWithin -> 
                    False]}]}}, GridBoxAlignment -> {"Columns" -> {{Left}}}, 
                    DefaultBaseStyle -> "Column", 
                    GridBoxItemSize -> {
                    "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}], 
                    "Column"], "SummaryItem"]}}, 
                 GridBoxAlignment -> {
                  "Columns" -> {{Left}}, "Rows" -> {{Automatic}}}, AutoDelete -> 
                 False, GridBoxItemSize -> {
                  "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
                 GridBoxSpacings -> {
                  "Columns" -> {{2}}, "Rows" -> {{Automatic}}}, 
                 BaseStyle -> {
                  ShowStringCharacters -> False, NumberMarks -> False, 
                   PrintPrecision -> 3, ShowSyntaxStyles -> False}]}}, 
              GridBoxAlignment -> {"Rows" -> {{Top}}}, AutoDelete -> False, 
              GridBoxItemSize -> {
               "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
              BaselinePosition -> {1, 1}]}, 
           Dynamic[Typeset`open$$], ImageSize -> Automatic], BaselinePosition -> 
          Baseline], DynamicModuleValues :> {}], 
        StyleBox["]", "NonInterpretableSummary"]}]},
     "CopyTag",
     DisplayFunction->(#& ),
     InterpretationFunction->("SparseArray[<1>, {2}]"& )],
    False,
    Editable->False,
    SelectWithContents->True,
    Selectable->False]}], "]"}]], "Output",
 CellChangeTimes->{3.662294424027063*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["testket"], "Input",
 CellChangeTimes->{{3.6622944309280167`*^9, 3.662294433472107*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{"VecSpace", "[", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
     "]"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5492836228094538`", ",", "0.2597667621238411`"}], "}"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{3.662294433840447*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ComposeMaps", "[", 
  RowBox[{
   RowBox[{"basisBra", "[", 
    RowBox[{"a", ",", "0"}], "]"}], ",", "testket"}], "]"}]], "Input",
 CellChangeTimes->{{3.6622944365404053`*^9, 3.662294456877819*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", "]"}], ",", "0.5492836228094538`"}], 
  "]"}]], "Output",
 CellChangeTimes->{{3.662294452449256*^9, 3.662294457548443*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"SystemMapping", "[", "t2", "]"}], "\[IndentingNewLine]", 
 RowBox[{"SystemMapping", "[", "t1", "]"}]}], "Input",
 CellChangeTimes->{{3.662293437756051*^9, 3.6622934482238827`*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", "\<\"b\"\>", "}"}], ",", 
   RowBox[{"{", "\<\"d\"\>", "}"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.662293442569584*^9, 3.662293448512362*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", "\<\"a\"\>", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"b\"\>", ",", "\<\"a\"\>"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.662293442569584*^9, 3.6622934485234747`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Canonicalize", "[", "t1", "]"}]], "Input",
 CellChangeTimes->{{3.6622930330765543`*^9, 3.6622930443994083`*^9}, {
  3.66229308716187*^9, 3.662293090514852*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.39835136704584473`", ",", "0.3306686456563852`", ",", 
         "0.8745138475735867`", ",", "0.7893264230344497`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.9693473192245197`", ",", "0.9986403264194381`", ",", 
         "0.0025954468653786034`", ",", "0.9982054881179574`"}], "}"}]}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.4321519155912239`", ",", "0.4671014571440244`", ",", 
         "0.9246720446187333`", ",", "0.7296303560476205`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.23996890711166752`", ",", "0.4206962325520236`", ",", 
         "0.305538611672749`", ",", "0.4773641671790507`"}], "}"}]}], "}"}]}],
     "}"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.662293035022613*^9, 3.662293044881469*^9}, {
  3.66229308366061*^9, 3.662293090799088*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"KetIndices", "[", 
  RowBox[{"MultiMap", "[", 
   RowBox[{
    RowBox[{"IndexDict", "[", "]"}], ",", "0.29597124389250995`"}], "]"}], 
  "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"KetIndices", "[", 
  RowBox[{"MultiMap", "[", 
   RowBox[{
    RowBox[{"IndexDict", "[", "]"}], ",", "0.29597124389250995`"}], "]"}], 
  "]"}]], "Output",
 CellChangeTimes->{3.66229300738666*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"testket", "[", 
   RowBox[{"[", "2", "]"}], "]"}], "//", "Norm"}]], "Input",
 CellChangeTimes->{{3.662294247490786*^9, 3.662294250748992*^9}}],

Cell[BoxData["0.6076111165794965`"], "Output",
 CellChangeTimes->{3.662294251071289*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"testket", "[", 
    RowBox[{"[", "2", "]"}], "]"}], "}"}], "//", 
  "SingularValueList"}]], "Input",
 CellChangeTimes->{{3.662293010013259*^9, 3.662293013291687*^9}, {
  3.662294228912176*^9, 3.662294239984455*^9}}],

Cell[BoxData[
 RowBox[{"{", "0.6076111165794965`", "}"}]], "Output",
 CellChangeTimes->{{3.662294232040297*^9, 3.6622942403288116`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"makeCanonical", "[", "t1", "]"}]], "Input",
 CellChangeTimes->{{3.6622899942493887`*^9, 3.662290007458552*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Flatten", "::", "normal"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Nonatomic expression expected at position \
\[NoBreak]\\!\\(1\\)\[NoBreak] in \
\[NoBreak]\\!\\(Flatten[False]\\)\[NoBreak]. \\!\\(\\*ButtonBox[\\\"\
\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/normal\\\", ButtonNote -> \
\\\"Flatten::normal\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.662291842359221*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Transpose", "::", "list"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"List expected at position \[NoBreak]\\!\\(2\\)\[NoBreak] \
in \[NoBreak]\\!\\(Transpose[\\(\\(\\(\\(MultiMap[\\(\\(\\(\\(IndexDict[\\(\\(\
\\(\\(VecSpace[\\(\\(AtomicSpace[\\(\\(\\(\\(System[\\(\\(\\\"a\\\", 2\\)\\)]\
\\)\\), \\\"ket\\\"\\)\\)]\\)\\)]\\)\\), \\(\\(VecSpace[\\(\\(AtomicSpace[\\(\
\\(\\(\\(System[\\(\\(\\\"b\\\", 4\\)\\)]\\)\\), \\\"bra\\\"\\)\\)]\\)\\)]\\)\
\\), \\(\\(VecSpace[\\(\\(AtomicSpace[\\(\\(\\(\\(System[\\(\\(\\\"a\\\", \
2\\)\\)]\\)\\), \\\"bra\\\"\\)\\)]\\)\\)]\\)\\)\\)\\)]\\)\\), \
\\(\\({\\(\\({0.15964959435891468`, 0.34878198140671124`}\\)\\), \
\\(\\({0.09714313896155269`, 0.10902843750792868`}\\)\\), \\(\\(\
\[LeftSkeleton] 5 \[RightSkeleton]\\)\\), \\(\\({0.6528189756191378`, \
0.26932802693719604`}\\)\\)}\\)\\)\\)\\)]\\)\\), \
\\(\\(Flatten[False]\\)\\)\\)\\)]\\)\[NoBreak]. \\!\\(\\*ButtonBox[\\\"\
\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/list\\\", ButtonNote -> \
\\\"Transpose::list\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.662291842395636*^9}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"TypeSort", "[", 
    RowBox[{
     RowBox[{"IndexDict", "[", 
      RowBox[{
       RowBox[{"VecSpace", "[", 
        RowBox[{"AtomicSpace", "[", 
         RowBox[{
          RowBox[{"System", "[", 
           RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], 
         "]"}], "]"}], ",", 
       RowBox[{"VecSpace", "[", 
        RowBox[{"AtomicSpace", "[", 
         RowBox[{
          RowBox[{"System", "[", 
           RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], 
         "]"}], "]"}], ",", 
       RowBox[{"VecSpace", "[", 
        RowBox[{"AtomicSpace", "[", 
         RowBox[{
          RowBox[{"System", "[", 
           RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], 
         "]"}], "]"}]}], "]"}], "\[Equal]", 
     RowBox[{"IndexDict", "[", "]"}]}], "]"}], ",", 
   RowBox[{"Transpose", "[", 
    RowBox[{
     RowBox[{"MultiMap", "[", 
      RowBox[{
       RowBox[{"IndexDict", "[", 
        RowBox[{
         RowBox[{"VecSpace", "[", 
          RowBox[{"AtomicSpace", "[", 
           RowBox[{
            RowBox[{"System", "[", 
             RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], 
           "]"}], "]"}], ",", 
         RowBox[{"VecSpace", "[", 
          RowBox[{"AtomicSpace", "[", 
           RowBox[{
            RowBox[{"System", "[", 
             RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], 
           "]"}], "]"}], ",", 
         RowBox[{"VecSpace", "[", 
          RowBox[{"AtomicSpace", "[", 
           RowBox[{
            RowBox[{"System", "[", 
             RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], 
           "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0.15964959435891468`", ",", "0.34878198140671124`"}], 
          "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.09714313896155269`", ",", "0.10902843750792868`"}], 
          "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.10256796133294088`", ",", "0.6486922615079826`"}], "}"}],
          ",", 
         RowBox[{"{", 
          RowBox[{"0.802404258700109`", ",", "0.1870379045975732`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"0.39594937365016714`", ",", "0.8440398271460301`"}], "}"}],
          ",", 
         RowBox[{"{", 
          RowBox[{"0.177321554073393`", ",", "0.5284425829183526`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"0.4314524635788253`", ",", "0.6225748055038844`"}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"0.6528189756191378`", ",", "0.26932802693719604`"}], 
          "}"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"Flatten", "[", "False", "]"}]}], "]"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.6622899988240967`*^9, 3.6622900077677*^9}, 
   3.662291842403026*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"VecSpace", "@@", 
  RowBox[{"Atoms", "[", "td1", "]"}]}]], "Input",
 CellChangeTimes->{{3.662291309495764*^9, 3.662291324248331*^9}}],

Cell[BoxData[
 RowBox[{"VecSpace", "[", 
  RowBox[{
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
   ",", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
   ",", 
   RowBox[{"AtomicSpace", "[", 
    RowBox[{
     RowBox[{"System", "[", 
      RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{{3.662291311360462*^9, 3.662291324680222*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"List", "@@", 
  RowBox[{"Dimension", "/@", 
   RowBox[{"IndexDict", "[", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.662290933707017*^9, 3.66229093654867*^9}}],

Cell[BoxData[
 RowBox[{"{", "}"}]], "Output",
 CellChangeTimes->{3.662290937349059*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["testket"], "Input",
 CellChangeTimes->{{3.6622917508743677`*^9, 3.66229175170045*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{"VecSpace", "[", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
     "]"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.1806525497134046`", ",", "0.905645722791361`"}], "}"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{3.66229175200989*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Atomize", "[", 
  RowBox[{"IndexDict", "[", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.662290959685238*^9, 3.662290964023961*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", "]"}]], "Output",
 CellChangeTimes->{3.66229096444415*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"makeCanonical", "[", 
  RowBox[{"MultiMap", "[", 
   RowBox[{
    RowBox[{"IndexDict", "[", "]"}], ",", "0.3479437041322474`"}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.662288710394362*^9, 3.662288720961688*^9}, {
   3.662290755557705*^9, 3.662290762699357*^9}, {3.662290813347913*^9, 
   3.662290814817157*^9}, 3.662290927014534*^9, {3.6622911627826023`*^9, 
   3.6622911653296347`*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Transpose", "::", "list"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"List expected at position \[NoBreak]\\!\\(2\\)\[NoBreak] \
in \[NoBreak]\\!\\(Transpose[\\(\\(0.3479437041322474`, \
\\(\\(IndexDict[]\\)\\)\\)\\)]\\)\[NoBreak]. \\!\\(\\*ButtonBox[\\\"\
\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/list\\\", ButtonNote -> \
\\\"Transpose::list\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.662291165782426*^9, 3.6622918994985943`*^9}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", "]"}], ",", 
   RowBox[{"Transpose", "[", 
    RowBox[{"0.3479437041322474`", ",", 
     RowBox[{"IndexDict", "[", "]"}]}], "]"}]}], "]"}]], "Output",
 CellChangeTimes->{3.662290763543538*^9, 3.6622908155105133`*^9, 
  3.6622910575574627`*^9, 3.662291165788443*^9, 3.6622918995068502`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"TypeSort", "[", 
  RowBox[{"IndexDict", "[", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.662291188084099*^9, 3.662291194439928*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", "]"}]], "Output",
 CellChangeTimes->{3.662291194748991*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SystemMapping", "[", 
  RowBox[{"MultiMap", "[", 
   RowBox[{
    RowBox[{"IndexDict", "[", "]"}], ",", "0.3479437041322474`"}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.662291073457246*^9, 3.6622911080621967`*^9}}],

Cell[BoxData[
 RowBox[{"MapDict", "[", 
  RowBox[{
   RowBox[{"{", "}"}], ",", 
   RowBox[{"{", "}"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.6622910804657907`*^9, 3.662291108447995*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["td1"], "Input",
 CellChangeTimes->{{3.662290262226583*^9, 3.6622902626642227`*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{
   RowBox[{"VecSpace", "[", 
    RowBox[{
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
     ",", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}]}],
     "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.662288713665547*^9, 3.662288716667676*^9}, 
   3.662290262948311*^9, 3.662291892647032*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimension", "[", 
  RowBox[{"VecSpace", "[", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.662290278206353*^9, 3.6622902876888313`*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Part", "::", "take"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Cannot take positions \[NoBreak]\\!\\(2\\)\[NoBreak] \
through \[NoBreak]\\!\\(-1\\)\[NoBreak] in \[NoBreak]\\!\\({}\\)\[NoBreak]. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/Part/take\\\", \
ButtonNote -> \\\"Part::take\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.6622902879945593`*^9}],

Cell[BoxData[
 RowBox[{"{", "}"}]], "Output",
 CellChangeTimes->{{3.662290280271706*^9, 3.66229028800073*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AtomicQ", "[", "t1", "]"}]], "Input",
 CellChangeTimes->{{3.6622885317198563`*^9, 3.662288536278944*^9}}],

Cell[BoxData["False"], "Output",
 CellChangeTimes->{3.662288536581756*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AtomicQ", "[", 
  RowBox[{"Atomize", "[", "t1", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.662288538264481*^9, 3.662288543860488*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.662288544271441*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimension", "/@", 
  RowBox[{"Atoms", "[", "td1", "]"}]}]], "Input",
 CellChangeTimes->{{3.662288462579537*^9, 3.662288473700831*^9}, {
  3.662288505780724*^9, 3.662288508374339*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2", ",", "4", ",", "2"}], "}"}]], "Output",
 CellChangeTimes->{{3.6622884659851427`*^9, 3.662288473998145*^9}, 
   3.662288508606636*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["td1"], "Input",
 CellChangeTimes->{{3.662288352230113*^9, 3.662288352687957*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{
   RowBox[{"VecSpace", "[", 
    RowBox[{
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
     ",", 
     RowBox[{"AtomicSpace", "[", 
      RowBox[{
       RowBox[{"System", "[", 
        RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}]}],
     "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}]}], "]"}]], "Output",
 CellChangeTimes->{3.66228835302213*^9}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"d\"\>", ",", "7"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0.5343795073619866`", ",", "0.28799484418399257`", ",", 
       "0.6453101737279017`", ",", "0.5373601596948936`", ",", 
       "0.48117595978629013`", ",", "0.39282018855034617`", ",", 
       "0.5413487629384046`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0.049416052408961075`", ",", "0.082431796908631`", ",", 
       "0.8872338069595231`", ",", "0.16437812680920727`", ",", 
       "0.4731087682148636`", ",", "0.2771070733859573`", ",", 
       "0.6745857028065809`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0.1348650892720047`", ",", "0.5289142846351615`", ",", 
       "0.9844229250004417`", ",", "0.18778186922631224`", ",", 
       "0.138050363421093`", ",", "0.8012526354973992`", ",", 
       "0.5957852495244889`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0.7052811088917128`", ",", "0.13825626189717988`", ",", 
       "0.35478615885442855`", ",", "0.4395439325540933`", ",", 
       "0.989133376934983`", ",", "0.6850079649465743`", ",", 
       "0.813877592174818`"}], "}"}]}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.6622887526890593`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AtomicQ", "[", "td2", "]"}]], "Input",
 CellChangeTimes->{{3.662288754426053*^9, 3.662288758642049*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.662288758994343*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AtomicQ", "[", "t2", "]"}]], "Input",
 CellChangeTimes->{{3.662288760843411*^9, 3.6622887654604063`*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.6622887657119093`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ComposeAtomicTensors", "[", 
  RowBox[{
   RowBox[{"Atomize", "[", "t1", "]"}], ",", "t2"}], "]"}]], "Input",
 CellChangeTimes->{{3.662288768995166*^9, 3.662288795280796*^9}}],

Cell[BoxData[
 RowBox[{"MultiMap", "[", 
  RowBox[{
   RowBox[{"IndexDict", "[", 
    RowBox[{
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}], ",", 
     RowBox[{"VecSpace", "[", 
      RowBox[{"AtomicSpace", "[", 
       RowBox[{
        RowBox[{"System", "[", 
         RowBox[{"\<\"d\"\>", ",", "7"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
      "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.6698673046472131`", ",", "0.21917301678653298`", ",", 
         "0.5748643617715494`", ",", "0.47370986560382766`", ",", 
         "0.9306231960221918`", ",", "0.7214687923474569`", ",", 
         "0.8661248075366618`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.41116993890050635`", ",", "0.47839658737393054`", ",", 
         "1.0267522699229283`", ",", "0.4093674530960072`", ",", 
         "0.4939654510683741`", ",", "0.8151099934891077`", ",", 
         "0.8010689596383528`"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "0.7389585284881949`", ",", "0.4471059948945507`", ",", 
         "1.069178669556269`", ",", "0.6098767734399286`", ",", 
         "0.9797009091958848`", ",", "0.9975625860129301`", ",", 
         "1.1223330384633101`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.751066709613477`", ",", "0.6531645842904447`", ",", 
         "1.721950379305651`", ",", "0.7757075390281163`", ",", 
         "1.0084905123458805`", ",", "1.1613226089881188`", ",", 
         "1.4035206594007816`"}], "}"}]}], "}"}]}], "}"}]}], "]"}]], "Output",\

 CellChangeTimes->{{3.662288776903743*^9, 3.662288795675673*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimension", "/@", 
  RowBox[{
   RowBox[{"ComposeAtomicTensors", "[", 
    RowBox[{"t2", ",", 
     RowBox[{"Atomize", "[", "t1", "]"}]}], "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.662288819400425*^9, 3.662288846752304*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{"4", ",", "7", ",", "2", ",", "4", ",", "2"}], "]"}]], "Output",
 CellChangeTimes->{{3.662288822068783*^9, 3.662288847099358*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{
   RowBox[{"ComposeAtomicTensors", "[", 
    RowBox[{"t2", ",", 
     RowBox[{"Atomize", "[", "t1", "]"}]}], "]"}], "[", 
   RowBox[{"[", "2", "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.662288855857635*^9, 3.662288865190621*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"4", ",", "7", ",", "2", ",", "4", ",", "2"}], "}"}]], "Output",
 CellChangeTimes->{3.662288865617394*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeAtomic", "[", "t1", "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}], "//", "AtomicQ"}]], "Input",
 CellChangeTimes->{{3.662288388429307*^9, 3.662288405381138*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{{3.662288395625368*^9, 3.662288405752717*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ComposeAtomicTensors", "[", 
   RowBox[{"t2", ",", 
    RowBox[{"Atomize", "[", "t1", "]"}]}], "]"}], "[", 
  RowBox[{"[", "1", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.6622882062143297`*^9, 3.662288206772327*^9}, {
  3.6622888732369204`*^9, 3.662288885956771*^9}}],

Cell[BoxData[
 RowBox[{"IndexDict", "[", 
  RowBox[{
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
    "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"d\"\>", ",", "7"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"ket\"\>"}], "]"}], 
    "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"b\"\>", ",", "4"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}], ",", 
   RowBox[{"VecSpace", "[", 
    RowBox[{"AtomicSpace", "[", 
     RowBox[{
      RowBox[{"System", "[", 
       RowBox[{"\<\"a\"\>", ",", "2"}], "]"}], ",", "\<\"bra\"\>"}], "]"}], 
    "]"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.662288878415844*^9, 3.662288886325203*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"List", "@@", 
  RowBox[{"Dimension", "/@", 
   RowBox[{"Atomize", "[", "td1", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.662288275026432*^9, 3.662288300488019*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2", ",", "4", ",", "2"}], "}"}]], "Output",
 CellChangeTimes->{{3.662288279829467*^9, 3.66228830129633*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{977, 755},
WindowMargins->{{28, Automatic}, {Automatic, 0}},
FrontEndVersion->"10.2 for Mac OS X x86 (32-bit, 64-bit Kernel) (July 6, \
2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "Info-01fa8e2c-9240-44a5-a414-d1b60338b5b9"->{
  Cell[70390, 2047, 156, 2, 40, "Print",
   CellTags->"Info-01fa8e2c-9240-44a5-a414-d1b60338b5b9"],
  Cell[70549, 2051, 1428, 39, 54, "Print",
   CellTags->"Info-01fa8e2c-9240-44a5-a414-d1b60338b5b9"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"Info-01fa8e2c-9240-44a5-a414-d1b60338b5b9", 238800, 6850}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 810, 15, 163, "Text"],
Cell[CellGroupData[{
Cell[1393, 39, 324, 7, 28, "Input"],
Cell[1720, 48, 380, 7, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2137, 60, 98, 1, 35, "Subsubsection"],
Cell[2238, 63, 461, 7, 68, "Text"],
Cell[2702, 72, 822, 18, 46, "Input"],
Cell[3527, 92, 1853, 50, 80, "Input"],
Cell[5383, 144, 1313, 32, 63, "Input"],
Cell[6699, 178, 350, 6, 49, "Text"],
Cell[7052, 186, 1354, 38, 80, "Input"],
Cell[CellGroupData[{
Cell[8431, 228, 300, 8, 28, "Input"],
Cell[8734, 238, 124, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[8895, 245, 294, 8, 28, "Input"],
Cell[9192, 255, 143, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9372, 262, 394, 10, 28, "Input"],
Cell[9769, 274, 98, 1, 28, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[9916, 281, 97, 1, 35, "Subsubsection"],
Cell[10016, 284, 328, 6, 49, "Text"],
Cell[10347, 292, 800, 20, 80, "Input"],
Cell[11150, 314, 396, 11, 46, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[11583, 330, 104, 1, 35, "Subsubsection"],
Cell[11690, 333, 480, 8, 49, "Text"],
Cell[12173, 343, 1247, 34, 114, "Input"],
Cell[13423, 379, 672, 18, 63, "Input"],
Cell[CellGroupData[{
Cell[14120, 401, 126, 2, 28, "Input"],
Cell[14249, 405, 102, 1, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14388, 411, 126, 2, 28, "Input"],
Cell[14517, 415, 100, 1, 28, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[14666, 422, 103, 1, 35, "Subsubsection"],
Cell[14772, 425, 311, 6, 30, "Text"],
Cell[CellGroupData[{
Cell[15108, 435, 525, 11, 63, "Input"],
Cell[15636, 448, 9757, 262, 243, "Output"]
}, Open  ]],
Cell[25408, 713, 1167, 34, 80, "Input"],
Cell[CellGroupData[{
Cell[26600, 751, 230, 4, 28, "Input"],
Cell[26833, 757, 253, 5, 28, "Output"]
}, Open  ]],
Cell[27101, 765, 119, 2, 28, "Input"],
Cell[CellGroupData[{
Cell[27245, 771, 132, 2, 28, "Input"],
Cell[27380, 775, 131, 3, 28, "Output"]
}, Open  ]],
Cell[27526, 781, 115, 1, 30, "Text"],
Cell[CellGroupData[{
Cell[27666, 786, 253, 7, 28, "Input"],
Cell[27922, 795, 408, 13, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[28367, 813, 387, 8, 28, "Input"],
Cell[28757, 823, 395, 7, 28, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[29201, 836, 104, 1, 35, "Subsubsection"],
Cell[29308, 839, 209, 4, 30, "Text"],
Cell[CellGroupData[{
Cell[29542, 847, 230, 5, 28, "Input"],
Cell[29775, 854, 820, 23, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[30632, 882, 454, 11, 28, "Input"],
Cell[31089, 895, 603, 16, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[31729, 916, 125, 2, 28, "Input"],
Cell[31857, 920, 16664, 441, 214, "Output"]
}, Open  ]],
Cell[48536, 1364, 1316, 36, 80, "Input"],
Cell[CellGroupData[{
Cell[49877, 1404, 231, 6, 28, "Input"],
Cell[50111, 1412, 742, 22, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[50890, 1439, 215, 4, 28, "Input"],
Cell[51108, 1445, 196, 3, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[51341, 1453, 149, 3, 28, "Input"],
Cell[51493, 1458, 187, 4, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[51717, 1467, 62, 1, 28, "Input"],
Cell[51782, 1470, 732, 21, 46, "Output"]
}, Open  ]],
Cell[52529, 1494, 738, 22, 46, "Input"],
Cell[CellGroupData[{
Cell[53292, 1520, 174, 3, 28, "Input"],
Cell[53469, 1525, 484, 14, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[53990, 1544, 152, 3, 28, "Input"],
Cell[54145, 1549, 155, 3, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[54337, 1557, 99, 1, 28, "Input"],
Cell[54439, 1560, 696, 21, 46, "Output"]
}, Open  ]],
Cell[55150, 1584, 1517, 40, 80, "Input"],
Cell[56670, 1626, 666, 17, 46, "Input"],
Cell[CellGroupData[{
Cell[57361, 1647, 134, 2, 28, "Input"],
Cell[57498, 1651, 270, 7, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[57805, 1663, 179, 3, 28, "Input"],
Cell[57987, 1668, 295, 7, 28, "Output"]
}, Open  ]],
Cell[58297, 1678, 120, 1, 30, "Text"],
Cell[58420, 1681, 1696, 46, 80, "Input"],
Cell[60119, 1729, 375, 7, 49, "Text"],
Cell[60497, 1738, 922, 24, 46, "Input"],
Cell[61422, 1764, 1427, 41, 80, "Input"],
Cell[62852, 1807, 1551, 41, 63, "Input"],
Cell[CellGroupData[{
Cell[64428, 1852, 286, 7, 28, "Input"],
Cell[64717, 1861, 415, 9, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[65169, 1875, 284, 7, 28, "Input"],
Cell[65456, 1884, 378, 10, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[65871, 1899, 130, 2, 28, "Input"],
Cell[66004, 1903, 123, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[66164, 1910, 97, 1, 28, "Input"],
Cell[66264, 1913, 696, 21, 46, "Output"]
}, Open  ]],
Cell[66975, 1937, 1689, 43, 80, "Input"],
Cell[CellGroupData[{
Cell[68689, 1984, 196, 4, 28, "Input"],
Cell[68888, 1990, 86, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[69011, 1997, 97, 1, 28, "Input"],
Cell[69111, 2000, 510, 15, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[69658, 2020, 235, 6, 28, "Input"],
Cell[69896, 2028, 301, 8, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[70234, 2041, 131, 2, 28, "Input"],
Cell[CellGroupData[{
Cell[70390, 2047, 156, 2, 40, "Print",
 CellTags->"Info-01fa8e2c-9240-44a5-a414-d1b60338b5b9"],
Cell[70549, 2051, 1428, 39, 54, "Print",
 CellTags->"Info-01fa8e2c-9240-44a5-a414-d1b60338b5b9"]
}, Open  ]]
}, Open  ]],
Cell[72004, 2094, 936, 24, 46, "Input"],
Cell[72943, 2120, 1128, 31, 80, "Input"],
Cell[CellGroupData[{
Cell[74096, 2155, 188, 4, 28, "Input"],
Cell[74287, 2161, 313, 8, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[74637, 2174, 281, 8, 28, "Input"],
Cell[74921, 2184, 438, 13, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[75396, 2202, 128, 2, 28, "Input"],
Cell[75527, 2206, 175, 4, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[75739, 2215, 130, 2, 28, "Input"],
Cell[75872, 2219, 282, 7, 28, "Output"]
}, Open  ]],
Cell[76169, 2229, 134, 2, 28, "Input"],
Cell[CellGroupData[{
Cell[76328, 2235, 160, 3, 28, "Input"],
Cell[76491, 2240, 754, 23, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[77282, 2268, 283, 7, 28, "Input"],
Cell[77568, 2277, 250, 4, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[77855, 2286, 262, 6, 28, "Input"],
Cell[78120, 2294, 213, 7, 28, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[78382, 2307, 99, 1, 35, "Subsubsection"],
Cell[78484, 2310, 426, 7, 49, "Text"],
Cell[78913, 2319, 1768, 45, 97, "Input"],
Cell[80684, 2366, 451, 12, 28, "Input"],
Cell[81138, 2380, 396, 11, 28, "Input"],
Cell[81537, 2393, 1701, 48, 97, "Input"],
Cell[83241, 2443, 365, 9, 28, "Input"],
Cell[83609, 2454, 1114, 29, 63, "Input"],
Cell[84726, 2485, 185, 5, 28, "Input"],
Cell[84914, 2492, 365, 9, 28, "Input"],
Cell[85282, 2503, 580, 12, 28, "Input"],
Cell[85865, 2517, 261, 6, 28, "Input"],
Cell[86129, 2525, 1968, 60, 97, "Input"],
Cell[CellGroupData[{
Cell[88122, 2589, 235, 4, 28, "Input"],
Cell[88360, 2595, 347, 8, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[88744, 2608, 94, 1, 28, "Input"],
Cell[88841, 2611, 1651, 46, 80, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[90529, 2662, 173, 3, 28, "Input"],
Cell[90705, 2667, 2119, 54, 114, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[92861, 2726, 159, 3, 28, "Input"],
Cell[93023, 2731, 2046, 53, 114, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[95106, 2789, 131, 2, 28, "Input"],
Cell[95240, 2793, 223, 6, 28, "Output"]
}, Open  ]],
Cell[95478, 2802, 71, 1, 28, "Input"],
Cell[CellGroupData[{
Cell[95574, 2807, 114, 2, 28, "Input"],
Cell[95691, 2811, 1656, 45, 63, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[97384, 2861, 155, 3, 28, "Input"],
Cell[97542, 2866, 2094, 54, 114, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[99673, 2925, 312, 7, 28, "Input"],
Cell[99988, 2934, 353, 9, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[100378, 2948, 231, 5, 28, "Input"],
Cell[100612, 2955, 223, 6, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[100872, 2966, 121, 2, 28, "Input"],
Cell[100996, 2970, 6173, 152, 284, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[107206, 3127, 180, 3, 28, "Input"],
Cell[107389, 3132, 523, 14, 28, "Output"]
}, Open  ]],
Cell[107927, 3149, 971, 26, 46, "Input"],
Cell[CellGroupData[{
Cell[108923, 3179, 195, 4, 28, "Input"],
Cell[109121, 3185, 246, 5, 28, "Output"]
}, Open  ]],
Cell[109382, 3193, 182, 2, 30, "Text"],
Cell[109567, 3197, 3089, 80, 148, "Input"],
Cell[112659, 3279, 2607, 69, 216, "Input"],
Cell[CellGroupData[{
Cell[115291, 3352, 94, 1, 28, "Input"],
Cell[115388, 3355, 1651, 46, 80, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[117076, 3406, 121, 2, 28, "Input"],
Cell[117200, 3410, 79, 1, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[117316, 3416, 293, 7, 28, "Input"],
Cell[117612, 3425, 683, 21, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[118332, 3451, 235, 4, 28, "Input"],
Cell[118570, 3457, 376, 8, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[118983, 3470, 241, 5, 28, "Input"],
Cell[119227, 3477, 330, 9, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[119594, 3491, 289, 7, 28, "Input"],
Cell[119886, 3500, 383, 8, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[120306, 3513, 127, 2, 28, "Input"],
Cell[120436, 3517, 16640, 440, 225, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[137113, 3962, 276, 7, 28, "Input"],
Cell[137392, 3971, 104, 1, 28, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[137545, 3978, 254, 3, 35, "Subsubsection"],
Cell[137802, 3983, 230, 3, 30, "Text"],
Cell[138035, 3988, 254, 5, 30, "Text"],
Cell[138292, 3995, 1115, 29, 46, "Input"],
Cell[139410, 4026, 1050, 29, 46, "Input"],
Cell[140463, 4057, 1666, 42, 80, "Input"],
Cell[142132, 4101, 512, 13, 28, "Input"],
Cell[142647, 4116, 1012, 29, 46, InheritFromParent],
Cell[CellGroupData[{
Cell[143684, 4149, 125, 2, 28, "Input"],
Cell[143812, 4153, 20699, 568, 198, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[164548, 4726, 313, 8, 28, "Input"],
Cell[164864, 4736, 20753, 569, 198, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[185666, 5311, 108, 1, 35, "Subsubsection"],
Cell[185777, 5314, 475, 8, 68, "Text"],
Cell[186255, 5324, 739, 19, 46, "Input"],
Cell[186997, 5345, 1339, 39, 63, "Input"],
Cell[188339, 5386, 316, 8, 28, "Input"],
Cell[188658, 5396, 1476, 42, 63, "Input"],
Cell[CellGroupData[{
Cell[190159, 5442, 94, 1, 28, "Input"],
Cell[190256, 5445, 1651, 46, 80, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[191944, 5496, 288, 6, 28, "Input"],
Cell[192235, 5504, 148, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[192420, 5511, 135, 2, 28, "Input"],
Cell[192558, 5515, 213, 7, 28, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[192820, 5528, 105, 1, 35, "Subsubsection"],
Cell[192928, 5531, 140, 1, 30, "Text"],
Cell[193071, 5534, 1238, 32, 63, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[194346, 5571, 107, 1, 35, "Subsubsection"],
Cell[194456, 5574, 1640, 40, 97, "Input"],
Cell[196099, 5616, 448, 8, 49, "Text"],
Cell[196550, 5626, 2715, 69, 182, "Input"],
Cell[199268, 5697, 211, 5, 28, "Input"],
Cell[CellGroupData[{
Cell[199504, 5706, 113, 2, 28, "Input"],
Cell[199620, 5710, 463, 10, 24, "Message"]
}, Open  ]],
Cell[CellGroupData[{
Cell[200120, 5725, 130, 2, 28, "Input"],
Cell[200253, 5729, 120, 2, 28, "Output"]
}, Open  ]],
Cell[200388, 5734, 178, 4, 30, "Text"],
Cell[200569, 5740, 800, 23, 63, "Input"],
Cell[201372, 5765, 814, 23, 63, "Input"],
Cell[CellGroupData[{
Cell[202211, 5792, 322, 7, 28, "Input"],
Cell[202536, 5801, 1416, 41, 63, "Output"]
}, Open  ]],
Cell[203967, 5845, 1052, 27, 63, "Input"],
Cell[CellGroupData[{
Cell[205044, 5876, 174, 3, 28, "Input"],
Cell[205221, 5881, 8151, 169, 65, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[213409, 6055, 101, 1, 28, "Input"],
Cell[213513, 6058, 448, 13, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[213998, 6076, 222, 5, 28, "Input"],
Cell[214223, 6083, 204, 5, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[214464, 6093, 205, 3, 46, "Input"],
Cell[214672, 6098, 214, 5, 28, "Output"],
Cell[214889, 6105, 249, 6, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[215175, 6116, 184, 3, 28, "Input"],
Cell[215362, 6121, 1720, 48, 80, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[217119, 6174, 177, 5, 28, "Input"],
Cell[217299, 6181, 219, 6, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[217555, 6192, 177, 4, 28, "Input"],
Cell[217735, 6198, 88, 1, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[217860, 6204, 267, 7, 28, "Input"],
Cell[218130, 6213, 136, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[218303, 6220, 135, 2, 28, "Input"],
Cell[218441, 6224, 510, 11, 24, "Message"],
Cell[218954, 6237, 1203, 20, 58, "Message"],
Cell[220160, 6259, 2910, 78, 114, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[223107, 6342, 157, 3, 28, "Input"],
Cell[223267, 6347, 607, 18, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[223911, 6370, 182, 4, 28, "Input"],
Cell[224096, 6376, 87, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[224220, 6383, 100, 1, 28, "Input"],
Cell[224323, 6386, 446, 13, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[224806, 6404, 157, 3, 28, "Input"],
Cell[224966, 6409, 99, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[225102, 6416, 421, 9, 28, "Input"],
Cell[225526, 6427, 569, 11, 24, "Message"],
Cell[226098, 6440, 370, 8, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[226505, 6453, 158, 3, 28, "Input"],
Cell[226666, 6458, 100, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[226803, 6465, 247, 6, 28, "Input"],
Cell[227053, 6473, 190, 5, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[227280, 6483, 97, 1, 28, "Input"],
Cell[227380, 6486, 768, 22, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[228185, 6513, 160, 3, 28, "Input"],
Cell[228348, 6518, 503, 10, 24, "Message"],
Cell[228854, 6530, 110, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[229001, 6537, 129, 2, 28, "Input"],
Cell[229133, 6541, 74, 1, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[229244, 6547, 161, 3, 28, "Input"],
Cell[229408, 6552, 73, 1, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[229518, 6558, 207, 4, 28, "Input"],
Cell[229728, 6564, 177, 4, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[229942, 6573, 95, 1, 28, "Input"],
Cell[230040, 6576, 695, 21, 46, "Output"],
Cell[230738, 6599, 1709, 43, 97, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[232484, 6647, 128, 2, 28, "Input"],
Cell[232615, 6651, 73, 1, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[232725, 6657, 129, 2, 28, "Input"],
Cell[232857, 6661, 75, 1, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[232969, 6667, 199, 4, 28, "Input"],
Cell[233171, 6673, 2075, 54, 114, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[235283, 6732, 288, 7, 28, "Input"],
Cell[235574, 6741, 182, 3, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[235793, 6749, 293, 7, 28, "Input"],
Cell[236089, 6758, 145, 3, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[236271, 6766, 213, 5, 28, "Input"],
Cell[236487, 6773, 97, 1, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[236621, 6779, 305, 7, 28, "Input"],
Cell[236929, 6788, 1132, 33, 63, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[238098, 6826, 188, 4, 28, "Input"],
Cell[238289, 6832, 148, 3, 28, "Output"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
